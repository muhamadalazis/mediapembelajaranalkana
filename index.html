<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alkana Explorer: Jelajahi Dunia Hidrokarbon Sederhana</title>
    <!-- html2canvas for certificate download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- (Dihapus) Three.js sebelumnya dipakai untuk Build-a-Molecule 3D -->
    <!-- Versi baru ronde 1 menggunakan kanvas 2D murni tanpa library eksternal -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 30px;
        }

        header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        header p {
            color: #555;
            font-size: 1.2em;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            height: 30px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .phase {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease;
        }

        .phase.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .phase-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .phase-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .instructions {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 5px;
        }

        .instructions h3 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .instructions h3::before {
            content: "üí°";
            margin-right: 10px;
            font-size: 1.5em;
        }

        .instructions ul {
            margin-left: 20px;
            color: #856404;
        }

        .instructions li {
            margin: 5px 0;
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            border-radius: 10px;
            margin: 20px 0;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .question-box {
            background: #e3f2fd;
            border-left: 5px solid #2196F3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .question-box h3 {
            color: #1976D2;
            margin-bottom: 15px;
        }

        .question-box p {
            color: #0d47a1;
            font-size: 1.1em;
            margin: 10px 0;
            font-weight: 500;
        }

        .molecule-viewer {
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            min-height: 400px;
        }

        .molecule-canvas {
            width: 100%;
            height: 350px;
            background: white;
            border-radius: 5px;
            position: relative;
        }

        .controls {
            margin: 20px 0;
            text-align: center;
        }

        .controls select,
        .controls input {
            padding: 10px 20px;
            font-size: 1em;
            border: 2px solid #667eea;
            border-radius: 5px;
            margin: 5px;
            background: white;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px 5px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }
        
        .table-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .table-input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }

        .graph-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* CSS untuk graphCanvas */
        #graphCanvas {
            width: 100% !important;
            max-width: 800px !important;
            height: 400px !important;
            display: block !important;
            margin: 0 auto !important;
            border: 3px solid #667eea !important;
            border-radius: 10px !important;
            background: white !important;
            cursor: crosshair !important;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3) !important;
        }

        .quiz-question {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .quiz-question h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .quiz-option {
            display: block;
            padding: 10px;
            margin: 8px 0;
            background: #f5f5f5;
            border: 2px solid transparent;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .quiz-option input {
            margin-right: 10px;
        }

        .feedback {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            display: block;
        }

        .feedback.incorrect {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
            display: block;
        }

        .certificate {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: 10px double #ff6b6b;
            padding: 30px 50px;
            margin: 20px auto;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 1000px;
            min-height: 600px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .certificate h2 {
            color: #d63031;
            font-size: 2em;
            margin-bottom: 15px;
            font-family: 'Georgia', serif;
        }

        .certificate p {
            font-size: 1.1em;
            margin: 10px 0;
            color: #2d3436;
        }

        .certificate .name {
            font-size: 1.8em;
            color: #0984e3;
            font-weight: bold;
            margin: 15px 0;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .alert-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        .molecule-structure {
            display: inline-block;
            margin: 10px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .atom {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            line-height: 40px;
            text-align: center;
            color: white;
            font-weight: bold;
            margin: 2px;
        }

        .carbon {
            background: #2c3e50;
        }

        .hydrogen {
            background: #3498db;
        }

        .table-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
            text-align: center;
        }

        .table-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .phase {
                padding: 15px;
            }

            .navigation {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin: 5px 0;
            }
        }

        .formula-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 15px 0;
        }

        .highlight {
            background: #ffeb3b;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .control-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .control-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üî¨ Alkana Explorer</h1>
            <p>Jelajahi Dunia Hidrokarbon Sederhana</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%;">0%</div>
            </div>
        </header>

        <!-- FASE 1: STIMULATION -->
        <div class="phase active" id="phase1">
            <div class="phase-header">
                <h2>üåü Fase 1: Stimulation (Pemberian Rangsangan)</h2>
            </div>

            <div class="instructions">
                <h3>Petunjuk Penggunaan</h3>
                <ul>
                    <li>Tonton kedua video di bawah ini tentang penggunaan bahan bakar fosil dalam kehidupan sehari-hari</li>
                    <li>Perhatikan bagaimana minyak bumi dan gas alam digunakan</li>
                    <li>Renungkan pertanyaan yang diberikan di bawah video</li>
                    <li>Putar model molekul 3D dengan memilih jenis molekul</li>
                    <li>Klik tombol "Lanjut ke Fase 2" setelah selesai mengamati</li>
                </ul>
            </div>

            <h3>üì∫ Video Pembelajaran</h3>
            
            <h4 style="margin-top: 20px; color: #667eea;">Video 1: Penggunaan Bahan Bakar Fosil</h4>
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/_uqXsuEC28U" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

            <div class="question-box" style="margin-top: 20px;">
                <h3>‚ùì Pertanyaan Rangsangan - Video 1</h3>
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #667eea;">
                    <p style="font-weight: bold; color: #667eea; margin-bottom: 10px;">1. Berdasarkan pemenggalan namanya saja ("hidro" dan "karbon"), apa dua unsur utama yang pasti menyusun senyawa tersebut?</p>
                    <textarea id="phase1Q1" placeholder="Tuliskan jawaban Anda di sini..." style="width: 100%; padding: 15px; font-size: 1.05em; border: 2px solid #667eea; border-radius: 8px; min-height: 80px; font-family: Arial, sans-serif;" rows="3"></textarea>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #667eea;">
                    <p style="font-weight: bold; color: #667eea; margin-bottom: 10px;">2. Apa contoh senyawa hidrokarbon yang dekat dengan kehidupan kita sehari-hari, yang disebutkan pada awal video?</p>
                    <textarea id="phase1Q2" placeholder="Tuliskan jawaban Anda di sini..." style="width: 100%; padding: 15px; font-size: 1.05em; border: 2px solid #667eea; border-radius: 8px; min-height: 80px; font-family: Arial, sans-serif;" rows="3"></textarea>
                </div>
            </div>

            <h4 style="margin-top: 20px; color: #667eea;">Video 2: Minyak Bumi dan Gas Alam</h4>
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/sGj4o0v9rxo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

            <div class="question-box" style="margin-top: 20px;">
                <h3>‚ùì Pertanyaan Rangsangan - Video 2</h3>
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #f5576c;">
                    <p style="font-weight: bold; color: #f5576c; margin-bottom: 10px;">1. Video ini menyebut alkana sebagai "hidrokarbon jenuh". Coba perhatikan baik-baik gambar Metana, Etana, dan Propana. Apakah kamu melihat ada ikatan selain ikatan tunggal (yang digambar sebagai garis lurus tunggal) di antara atom-atomnya?</p>
                    <textarea id="phase1Q3" placeholder="Tuliskan jawaban Anda di sini..." style="width: 100%; padding: 15px; font-size: 1.05em; border: 2px solid #f5576c; border-radius: 8px; min-height: 80px; font-family: Arial, sans-serif;" rows="3"></textarea>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #f5576c;">
                    <p style="font-weight: bold; color: #f5576c; margin-bottom: 10px;">2. Mengapa menurut kalian alkana disebut "jenuh"?</p>
                    <textarea id="phase1Q4" placeholder="Tuliskan jawaban Anda di sini..." style="width: 100%; padding: 15px; font-size: 1.05em; border: 2px solid #f5576c; border-radius: 8px; min-height: 80px; font-family: Arial, sans-serif;" rows="3"></textarea>
                </div>
            </div>

            <div id="phase1SubmitFeedback" style="display: none; padding: 15px; border-radius: 8px; margin: 20px 0;"></div>

            <div class="navigation">
                <button class="btn" disabled style="opacity: 0.5;">‚¨Ö Sebelumnya</button>
                <button class="btn" onclick="submitPhase1()" id="phase1SubmitBtn">‚úì Submit Jawaban Refleksi</button>
                <button class="btn" onclick="goToPhase(2)" id="phase1NextBtn" style="display: none;">Lanjut ke Fase 2 ‚û°</button>
            </div>
        </div>

        <!-- FASE 2: PROBLEM STATEMENT -->
        <div class="phase" id="phase2">
            <div class="phase-header">
                <h2>üéØ Fase 2: Problem Statement (Identifikasi Masalah)</h2>
                <p>Mari Kita Selidiki!</p>
            </div>

            <div class="instructions">
                <h3>Petunjuk Penggunaan</h3>
                <ul>
                    <li>Perhatikan dengan seksama data 4 anggota "Keluarga Alkana" di tabel</li>
                    <li>Amati pola yang ada pada jumlah atom C dan H</li>
                    <li>Temukan teka-teki atau pertanyaan besar yang tersembunyi di dalam data</li>
                    <li>Rumuskan masalah/pertanyaan yang harus kita pecahkan bersama</li>
                    <li>Tuliskan pemikiran Anda di kotak yang disediakan</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin: 20px 0; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);">
                <h3 style="font-size: 1.5em; margin-bottom: 15px; text-align: center;">üîç MARI KITA SELIDIKI!</h3>
                <p style="font-size: 1.15em; line-height: 1.8; text-align: center;">
                    Kalian baru saja melihat 4 anggota <strong>"Keluarga Alkana"</strong> di video tadi.<br>
                    Coba kita tuliskan lagi datanya:
                </p>
            </div>

            <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h3 style="color: #667eea; text-align: center; margin-bottom: 20px;">üìä Data Keluarga Alkana</h3>
                <table class="data-table" style="margin: 0 auto; max-width: 600px;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <th>Nama Senyawa</th>
                            <th>Jumlah Atom C (Karbon)</th>
                            <th>Jumlah Atom H (Hidrogen)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="font-weight: bold; color: #667eea;">Metana</td>
                            <td style="text-align: center; font-size: 1.2em; font-weight: bold;">1</td>
                            <td style="text-align: center; font-size: 1.2em; font-weight: bold;">4</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: #667eea;">Etana</td>
                            <td style="text-align: center; font-size: 1.2em; font-weight: bold;">2</td>
                            <td style="text-align: center; font-size: 1.2em; font-weight: bold;">6</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: #667eea;">Propana</td>
                            <td style="text-align: center; font-size: 1.2em; font-weight: bold;">3</td>
                            <td style="text-align: center; font-size: 1.2em; font-weight: bold;">8</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; color: #667eea;">Butana</td>
                            <td style="text-align: center; font-size: 1.2em; font-weight: bold;">4</td>
                            <td style="text-align: center; font-size: 1.2em; font-weight: bold;">10</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="background: #fff9c4; border: 4px solid #ffc107; padding: 30px; border-radius: 15px; margin: 30px 0; box-shadow: 0 6px 20px rgba(255, 193, 7, 0.3);">
                <h3 style="color: #f57c00; text-align: center; font-size: 1.4em; margin-bottom: 20px;">üß© TUGAS KALIAN:</h3>
                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <p style="color: #333; font-size: 1.15em; line-height: 1.8; margin: 0;">
                        <strong>Perhatikan baik-baik data di tabel itu.</strong><br>
                        Mereka semua adalah bagian dari satu <strong>"keluarga"</strong> yang sama.
                    </p>
                </div>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; border-left: 5px solid #2196F3; margin-bottom: 20px;">
                    <p style="color: #1565c0; font-size: 1.15em; font-weight: bold; margin: 0;">
                        üí° Menurut kalian, apa <span style="background: #ffeb3b; padding: 2px 8px; border-radius: 5px; color: #333;">teka-teki</span> atau <span style="background: #ffeb3b; padding: 2px 8px; border-radius: 5px; color: #333;">pertanyaan besar</span> yang tersembunyi di dalam data tersebut?
                    </p>
                </div>

                <p style="color: #666; font-size: 1.05em; margin-bottom: 15px; text-align: center;">
                    <strong>Coba tuliskan satu pertanyaan/masalah yang harus kita pecahkan bersama:</strong>
                </p>

                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <label style="display: block; font-weight: bold; color: #f57c00; margin-bottom: 10px; font-size: 1.1em;">
                        ‚úçÔ∏è Masalah yang saya temukan adalah...
                    </label>
                    <textarea id="studentProblem" placeholder="" 
                        style="width: 100%; padding: 20px; font-size: 1.1em; border: 3px solid #ffc107; border-radius: 10px; min-height: 120px; font-family: Arial, sans-serif; line-height: 1.6;"
                        rows="5"></textarea>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px; border-left: 4px solid #667eea;">
                        <p style="margin: 0; color: #555; font-size: 0.95em;">
                            <strong>üí≠ Tips:</strong> Tidak ada jawaban yang salah! Tuliskan apa yang Anda pikirkan setelah melihat data tersebut. 
                            Pertanyaan Anda akan memandu eksplorasi di fase berikutnya.
                        </p>
                    </div>
                </div>
            </div>

            <div style="background: #e8f5e9; border: 3px dashed #4caf50; padding: 25px; border-radius: 10px; text-align: center; margin: 30px 0;">
                <h3 style="color: #2e7d32; font-size: 1.3em; margin-bottom: 10px;">ÔøΩ Langkah Selanjutnya</h3>
                <p style="color: #1b5e20; font-size: 1.1em; margin: 0;">
                    Setelah merumuskan masalah Anda, kita akan menggunakan <strong>Lab Virtual</strong> di fase berikutnya untuk mengumpulkan lebih banyak data dan memecahkan teka-teki ini bersama!
                </p>
            </div>

            <div id="phase2SubmitFeedback" style="display: none; padding: 15px; border-radius: 8px; margin: 20px 0;"></div>

            <div class="navigation">
                <button class="btn btn-secondary" onclick="goToPhase(1)">‚¨Ö Kembali ke Fase 1</button>
                <button class="btn" onclick="submitPhase2()" id="phase2SubmitBtn">‚úì Submit Rumusan Masalah</button>
                <button class="btn" onclick="goToPhase(3)" id="phase2NextBtn" style="display: none;">Lanjut ke Lab Virtual ‚û°</button>
            </div>
        </div>

        <!-- FASE 3: DATA COLLECTION -->
        <div class="phase" id="phase3">
            <div class="phase-header">
                <h2>üî¨ Fase 3: Data Collection (Pengumpulan Data)</h2>
                <p>Lab Virtual: Eksplorasi Alkana</p>
            </div>

            <div class="instructions">
                <h3>Petunjuk Penggunaan</h3>
                <ul>
                    <li>Pilih molekul alkana dari dropdown menu (Metana hingga Pentana)</li>
                    <li>Amati struktur 3D molekul yang ditampilkan dengan seksama</li>
                    <li>Perhatikan warna atom: Hitam = Karbon (C), Biru = Hidrogen (H)</li>
                    <li>Tabel data akan terisi otomatis saat Anda memilih molekul</li>
                    <li>Kumpulkan data untuk minimal 3 jenis alkana berbeda</li>
                    <li>Catat pola yang Anda amati sebelum lanjut ke fase berikutnya</li>
                </ul>
            </div>

            <h3>üß¨ Visualizer Molekul Alkana 3D Interaktif</h3>
            
            <div class="controls">
                <label for="alkaneSelect"><strong>Pilih Alkana:</strong> </label>
                <select id="alkaneSelect" onchange="displayAlkane()">
                    <option value="">-- Pilih Molekul --</option>
                    <option value="methane">Metana</option>
                    <option value="ethane">Etana</option>
                    <option value="propane">Propana</option>
                    <option value="butane">Butana</option>
                    <option value="pentane">Pentana</option>
                    <option value="hexane">Heksana</option>
                    <option value="heptane">Heptana</option>
                    <option value="octane">Oktana</option>
                    <option value="nonane">Nonana</option>
                    <option value="decane">Dekana</option>
                </select>
            </div>

            <div class="molecule-viewer">
                <div style="position: relative;">
                    <canvas id="alkaneCanvas" width="800" height="550" style="border: 1px solid #ddd; border-radius: 10px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); cursor: grab; display: block; margin: 0 auto;"></canvas>
                    <div style="position: absolute; bottom: 15px; left: 15px; background: rgba(255,255,255,0.9); padding: 10px 15px; border-radius: 8px; font-size: 0.85em;">
                        <div style="margin-bottom: 5px;"><strong>üéÆ Kontrol:</strong></div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="zoomIn()" class="control-btn" title="Zoom In">üîç+</button>
                            <button onclick="zoomOut()" class="control-btn" title="Zoom Out">üîç-</button>
                            <button onclick="resetView()" class="control-btn" title="Reset View">üîÑ</button>
                            <button onclick="toggleAutoRotate()" class="control-btn" id="rotateBtn" title="Toggle Rotation">‚è∏Ô∏è</button>
                        </div>
                    </div>
                    <div style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.9); padding: 8px 12px; border-radius: 8px; font-size: 0.8em;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 20px; height: 20px; border-radius: 50%; background: #1a1a1a; border: 1px solid #666;"></div>
                                <span>Karbon (C)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 20px; height: 20px; border-radius: 50%; background: linear-gradient(135deg, #ffffff, #e0e0e0); border: 1px solid #999;"></div>
                                <span>Hidrogen (H)</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="alkaneFormula" class="formula-display"></div>
                <p style="color: #666; margin-top: 10px; font-size: 0.9em;">üí° Klik dan drag untuk memutar molekul 3D | Scroll untuk zoom</p>
            </div>

            <h3 style="margin-top: 30px;">üìä Tabel Data Eksplorasi</h3>
            <p style="color: #555; margin: 10px 0;">Lengkapi tabel ini dengan mengamati molekul yang Anda pilih di atas. Catat jumlah atom C, H, dan gambarlah strukturnya.</p>

            <table class="data-table" id="dataTable">
                <thead>
                    <tr>
                        <th>Nama Alkana</th>
                        <th>Jumlah Atom C (n)</th>
                        <th>Jumlah Atom H</th>
                        <th>Rumus Molekul</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody">
                    <tr>
                        <td>Metana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                    <tr>
                        <td>Etana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                    <tr>
                        <td>Propana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                    <tr>
                        <td>Butana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                    <tr>
                        <td>Pentana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                    <tr>
                        <td>Heksana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                    <tr>
                        <td>Heptana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                    <tr>
                        <td>Oktana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                    <tr>
                        <td>Nonana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                    <tr>
                        <td>Dekana</td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="number" class="table-input" placeholder="..."></td>
                        <td style="background: #fff9c4;"><input type="text" class="table-input" placeholder="..."></td>
                    </tr>
                </tbody>
            </table>

            <div id="phase3SubmitFeedback" style="display: none; padding: 15px; border-radius: 8px; margin: 20px 0;"></div>

            <div class="navigation">
                <button class="btn btn-secondary" onclick="goToPhase(2)">‚¨Ö Kembali ke Fase 2</button>
                <button class="btn" onclick="submitPhase3()" id="phase3SubmitBtn">‚úì Submit Data Tabel</button>
                <button class="btn" onclick="goToPhase(4)" id="phase3NextBtn" style="display: none;">Lanjut ke Analisis Data ‚û°</button>
            </div>
        </div>

        <!-- FASE 4: DATA PROCESSING -->
        <div class="phase" id="phase4">
            <div class="phase-header">
                <h2>üìà Fase 4: Data Processing (Pengolahan Data)</h2>
                <p>Analisis Data</p>
            </div>

            <div class="instructions">
                <h3>Petunjuk Penggunaan</h3>
                <ul>
                    <li>Jawab pertanyaan pemandu berdasarkan pengamatan model 3D di fase sebelumnya</li>
                    <li>Tuliskan ciri-ciri alkana yang Anda temukan di kolom yang disediakan</li>
                    <li>Klik tombol "Tampilkan Grafik Pola" untuk melihat visualisasi data</li>
                    <li>Amati pola pada grafik dengan seksama</li>
                    <li>Perhatikan persamaan garis yang muncul (y = 2x + 2)</li>
                    <li>Tuliskan rumus umum alkana yang Anda temukan (dalam bentuk C‚ÇôH...)</li>
                </ul>
            </div>

            <h3>üîç Panduan Analisis Ciri-Ciri</h3>
            
            <div class="question-box">
                <h3>Pertanyaan Pemandu:</h3>
                <p>‚Ä¢ Amati model 3D dan rumus struktur dari beberapa alkana tersebut</p>
                <p>‚Ä¢ Unsur apa saja yang menyusunnya?</p>
                <p>‚Ä¢ Bagaimana ikatan antar atomnya?</p>
                <p>‚Ä¢ Apakah semua ikatan C-C berupa ikatan tunggal, rangkap dua, atau rangkap tiga?</p>
            </div>

            <h4 style="margin-top: 20px; color: #667eea;">üìù Tuliskan Ciri-Ciri Alkana yang Anda Identifikasi:</h4>
            <textarea id="characteristicsInput" placeholder=""></textarea>

            <h3 style="margin-top: 40px;">üìä Alat Bantu Analisis Rumus</h3>
            
            <div class="graph-container" style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin: 20px 0;">
                <h4 style="color: #667eea; margin-bottom: 15px; text-align: center; font-size: 1.4em;">üìà Buat Grafik Pola Data Anda Sendiri!</h4>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #667eea;">
                    <p style="color: #1565c0; margin: 5px 0; font-weight: bold; font-size: 1.1em;">üìå Petunjuk Membuat Grafik:</p>
                    <ul style="color: #1565c0; margin: 10px 0 5px 20px; line-height: 2; font-size: 1.05em;">
                        <li><strong>Sumbu X (horizontal)</strong> = Jumlah Atom Karbon (C)</li>
                        <li><strong>Sumbu Y (vertikal)</strong> = Jumlah Atom Hidrogen (H)</li>
                        <li><strong>Klik pada grafik</strong> untuk menempatkan titik sesuai data yang Anda amati dari Fase 3</li>
                        <li>Setelah semua titik ditempatkan, klik <strong>"Hubungkan Titik dengan Garis"</strong></li>
                        <li>Amati pola yang terbentuk dan <strong>cari persamaan garisnya!</strong></li>
                    </ul>
                </div>
                
                <!-- STATUS -->
                <div id="plotStatus" style="text-align:center; margin: 5px 0 0 0; font-weight:bold; color:#667eea; min-height:22px;">
                    Klik pada grafik untuk menempatkan titik data (X = Jumlah C, Y = Jumlah H)
                </div>
                
                <!-- GRAFIK CANVAS -->
                <div style="width: 100%; text-align: center; padding: 24px; background: #f5f7fb; border: 2px solid #c5d3ff; margin: 25px 0 10px 0; border-radius: 14px; position: relative;">
                    <div style="position:absolute; top:8px; left:16px; background:#667eea; color:#fff; padding:4px 10px; border-radius:6px; font-size:12px; font-weight:600; letter-spacing:.5px; box-shadow:0 2px 6px rgba(0,0,0,.15);">GRAFIK INTERAKTIF</div>
                    
                    <canvas id="graphCanvas" 
                            width="800" 
                            height="400"></canvas>
                    
                </div>
                <div style="text-align:center; font-size:0.9em; color:#555; margin-top:4px;">Sumbu X = Jumlah atom C | Sumbu Y = Jumlah atom H</div>
                
                <div style="text-align: center; margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn" id="connectBtn" onclick="connectPoints()" style="display: none; background: #28a745;">ÔøΩ Hubungkan Titik dengan Garis</button>
                    <button class="btn btn-secondary" onclick="resetGraph()">üîÑ Reset Grafik</button>
                </div>
            </div>

            <div id="patternMessage" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 3px solid #FFD700; padding: 30px; border-radius: 15px; margin: 30px 0 10px 0; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); animation: revealFormula 1s ease-out;">
                <h3 style="color: #fff; margin-bottom: 20px; text-align: center; font-size: 1.5em;">üéØ Pola Terlihat!</h3>
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                    <p style="color: #333; font-size: 1.1em; line-height: 1.8; margin: 15px 0;">
                        Titik-titik membentuk sebuah <strong style="color: #667eea;">garis lurus</strong>!<br><br>
                        <strong>Coba perhatikan:</strong><br>
                        ‚Ä¢ Bagaimana hubungan antara jumlah C (sumbu X) dan jumlah H (sumbu Y)?<br>
                        ‚Ä¢ Apakah ada pola matematika yang bisa Anda temukan?<br>
                        ‚Ä¢ Coba tuliskan persamaan garisnya dalam bentuk <strong>y = ... x + ...</strong>
                    </p>
                    <div style="background: #fff9c4; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #555; font-weight: bold;">‚úçÔ∏è Tuliskan Persamaan Garis yang Anda Temukan:</label>
                        <input type="text" id="equationGuess" placeholder="y = ... x + ..." style="width: 100%; padding: 12px; font-size: 1.1em; border: 2px solid #667eea; border-radius: 8px; margin-bottom: 10px;">
                        <button class="btn" onclick="checkEquation()" style="width: 100%;">Cek Jawaban</button>
                        <div id="equationFeedback" style="margin-top: 10px;"></div>
                    </div>
                </div>
            </div>

            <div id="ahaMessage" style="display: none; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border: 3px solid #FFD700; padding: 30px; border-radius: 15px; margin: 10px 0 30px 0; box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3); animation: revealFormula 1s ease-out;">
                <h3 style="color: #fff; margin-bottom: 20px; text-align: center; font-size: 1.5em;">üéâ Persamaan Benar! üéâ</h3>
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); animation: pulse 2s infinite;">
                    <div class="formula-display" style="text-align: center; font-size: 1.3em; margin: 15px 0;">
                        Persamaan Garis: <span class="highlight" style="color: #667eea; font-size: 1.4em; font-weight: bold;">y = 2x + 2</span>
                    </div>
                    <hr style="border: 2px solid #667eea; margin: 20px 0;">
                    <p style="color: #333; font-size: 1.1em; line-height: 1.8; margin-top: 15px;">
                        <strong>Sekarang mari kita terapkan ke alkana:</strong><br>
                        ‚Ä¢ <strong style="color: #f5576c;">y</strong> = Jumlah atom Hidrogen (H)<br>
                        ‚Ä¢ <strong style="color: #667eea;">x</strong> = Jumlah atom Karbon (C) atau <strong>n</strong><br><br>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 5px solid #ffc107;">
                            <strong style="color: #856404; font-size: 1.2em;">Jadi: Jumlah H = 2 √ó (Jumlah C) + 2</strong><br>
                            <strong style="color: #856404; font-size: 1.2em; margin-top: 10px; display: block;">Atau: H = 2n + 2</strong>
                        </div>
                    </p>
                </div>
            </div>

            <h4 style="margin-top: 20px; color: #667eea;">‚úçÔ∏è Sekarang Tuliskan Rumus Umum Alkana yang Anda Temukan:</h4>
            <p style="color: #555; margin: 10px 0;">Petunjuk: Gunakan format C<sub>n</sub>H<sub>...</sub> (dimana n adalah jumlah atom karbon)</p>
            <div style="background: #fff9c4; padding: 15px; border-radius: 8px; margin: 10px 0;">
                <input type="text" id="formulaInput" placeholder="" style="width: 100%; padding: 15px; font-size: 1.2em; border: 2px solid #667eea; border-radius: 10px;">
            </div>

            <div id="phase4SubmitFeedback" style="display: none; padding: 15px; border-radius: 8px; margin: 20px 0;"></div>

            <div class="navigation">
                <button class="btn btn-secondary" onclick="goToPhase(3)">‚¨Ö Kembali ke Lab Virtual</button>
                <button class="btn" onclick="submitPhase4()" id="phase4SubmitBtn">‚úì Submit Analisis</button>
                <button class="btn" onclick="goToPhase(5)" id="phase4NextBtn" style="display: none;">Lanjut ke Verifikasi ‚û°</button>
            </div>
        </div>

        <!-- FASE 5: VERIFICATION -->
        <div class="phase" id="phase5">
            <div class="phase-header">
                <h2>üéÆ Fase 5: Verification Game (Pembuktian Melalui Permainan)</h2>
                <p style="font-size: 1.1em; color: #555;">Uji pemahamanmu melalui 6 ronde permainan yang menantang!</p>
            </div>

            <div class="instructions">
                <h3>üìã Cara Bermain</h3>
                <ul>
                    <li>Kerjakan 6 ronde permainan secara berurutan</li>
                    <li>Setiap ronde memiliki tantangan berbeda</li>
                    <li>Kumpulkan bintang ‚≠ê sebanyak mungkin (maksimal 18 bintang)</li>
                    <li>Unlock ronde berikutnya dengan menyelesaikan ronde sebelumnya</li>
                    <li>Gunakan power-ups jika kesulitan</li>
                    <li>Kalahkan "Professor Alkana" di ronde terakhir!</li>
                </ul>
            </div>

            <!-- Game Progress Dashboard -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; margin: 20px 0; color: white; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);">
                <h3 style="margin: 0 0 15px 0; text-align: center;">üèÜ Progress Permainan</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em;">‚≠ê</div>
                        <div style="font-size: 1.5em; font-weight: bold;"><span id="totalStars">0</span>/18</div>
                        <div style="font-size: 0.9em;">Total Bintang</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em;">üéØ</div>
                        <div style="font-size: 1.5em; font-weight: bold;"><span id="currentRound">1</span>/6</div>
                        <div style="font-size: 0.9em;">Ronde Sekarang</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2em;">üíé</div>
                        <div style="font-size: 1.5em; font-weight: bold;"><span id="powerUps">3</span></div>
                        <div style="font-size: 0.9em;">Power-ups</div>
                    </div>
                </div>
            </div>

            <!-- RONDE 1: Membuat Prediksi (Data Baru) -->
            <div id="round1" class="game-round" style="display:block;">
                <div style="background:white; padding:25px; border-radius:15px; margin:20px 0; border:3px solid #667eea; box-shadow:0 5px 15px rgba(0,0,0,0.1);">
                    <h3 style="margin-top:0; color:#667eea;">üß† Ronde 1: Membuat Prediksi (Data Baru)</h3>
                    <div style="background:#eef5ff; padding:14px 18px; border-left:5px solid #667eea; border-radius:8px; font-size:0.92em; line-height:1.55; color:#333; margin:15px 0;">
                        Gunakan <strong>rumus umum alkana</strong> yang Anda temukan (C<sub>n</sub>H<sub>2n+2</sub>) untuk memprediksi jumlah atom H pada alkana berikut yang belum diamati pada fase sebelumnya. Isikan prediksi Anda lalu tekan tombol evaluasi. Lakukan secara mandiri terlebih dahulu sebelum melihat hasil verifikasi.
                    </div>
                    <table style="width:100%; border-collapse:collapse; margin-top:10px;">
                        <thead>
                            <tr style="background:#667eea; color:#fff;">
                                <th style="padding:10px; text-align:left;">Nama Alkana</th>
                                <th style="padding:10px; text-align:left;">Jumlah Atom C (n)</th>
                                <th style="padding:10px; text-align:left;">Prediksi Jumlah Atom H Anda?</th>
                                <th style="padding:10px; text-align:left;">Verifikasi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding:8px;">Heksana</td>
                                <td style="padding:8px;">6</td>
                                <td style="padding:8px;"><input id="predH6" type="number" min="0" style="width:100%; padding:6px;" ></td>
                                <td style="padding:8px;" id="verify6">-</td>
                            </tr>
                            <tr style="background:#f8f9fa;">
                                <td style="padding:8px;">Heptana</td>
                                <td style="padding:8px;">7</td>
                                <td style="padding:8px;"><input id="predH7" type="number" min="0" style="width:100%; padding:6px;" ></td>
                                <td style="padding:8px;" id="verify7">-</td>
                            </tr>
                            <tr>
                                <td style="padding:8px;">Oktana</td>
                                <td style="padding:8px;">8</td>
                                <td style="padding:8px;"><input id="predH8" type="number" min="0" style="width:100%; padding:6px;" ></td>
                                <td style="padding:8px;" id="verify8">-</td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="btn" onclick="evaluatePredictions()" style="width:100%; margin-top:18px; font-size:1.05em;">‚úÖ Evaluasi Prediksi</button>
                    <div id="round1Feedback" style="margin-top:15px; padding:15px; border-radius:10px; display:none;"></div>
                    <button id="round1Next" class="btn" onclick="unlockRound(2)" style="width:100%; margin-top:15px; display:none;">Lanjut ke Ronde 2 ‚û°</button>
                </div>
            </div>

            <!-- RONDE 2: Klasifikasi Alkana Berdasarkan Rumus -->
            <div id="round2" class="game-round" style="display:none;">
                <div style="background:white; padding:25px; border-radius:15px; margin:20px 0; border:3px solid #28a745; box-shadow:0 5px 15px rgba(0,0,0,0.1);">
                    <h3 style="color:#28a745; margin-top:0;">üß™ Ronde 2: Klasifikasi Berdasarkan Rumus</h3>
                    <div style="background:#e9f8ef; padding:14px 18px; border-left:5px solid #28a745; border-radius:8px; font-size:0.92em; line-height:1.55; color:#2e4d31; margin:15px 0;">
                        Tentukan apakah setiap senyawa di bawah merupakan <strong>alkana</strong> atau bukan menurut rumus umum yang Anda gunakan. Pilih "Ya" jika sesuai pola C<sub>n</sub>H<sub>2n+2</sub>, pilih "Tidak" jika tidak sesuai. Setelah itu lakukan verifikasi.
                    </div>
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background:#28a745; color:#fff;">
                                <th style="padding:10px; text-align:left;">Senyawa</th>
                                <th style="padding:10px; text-align:left;">Rumus Kimia</th>
                                <th style="padding:10px; text-align:left;">Apakah Alkana? (Menurut Rumus Anda)</th>
                                <th style="padding:10px; text-align:left;">Verifikasi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding:8px;">Senyawa A</td>
                                <td style="padding:8px;">C‚ÇÖH‚ÇÅ‚ÇÄ</td>
                                <td style="padding:8px;">
                                    <select id="classA" style="width:100%; padding:6px;">
                                        <option value="">--Pilih--</option>
                                        <option value="ya">Ya</option>
                                        <option value="tidak">Tidak</option>
                                    </select>
                                </td>
                                <td style="padding:8px;" id="verifyA">-</td>
                            </tr>
                            <tr style="background:#f8f9fa;">
                                <td style="padding:8px;">Senyawa B</td>
                                <td style="padding:8px;">C‚ÇâH‚ÇÇ‚ÇÄ</td>
                                <td style="padding:8px;">
                                    <select id="classB" style="width:100%; padding:6px;">
                                        <option value="">--Pilih--</option>
                                        <option value="ya">Ya</option>
                                        <option value="tidak">Tidak</option>
                                    </select>
                                </td>
                                <td style="padding:8px;" id="verifyB">-</td>
                            </tr>
                            <tr>
                                <td style="padding:8px;">Senyawa C</td>
                                <td style="padding:8px;">C‚ÇÑH‚Çà</td>
                                <td style="padding:8px;">
                                    <select id="classC" style="width:100%; padding:6px;">
                                        <option value="">--Pilih--</option>
                                        <option value="ya">Ya</option>
                                        <option value="tidak">Tidak</option>
                                    </select>
                                </td>
                                <td style="padding:8px;" id="verifyC">-</td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="btn" onclick="evaluateClassification()" style="width:100%; margin-top:18px; font-size:1.05em;">üîç Verifikasi Klasifikasi</button>
                    <div id="round2Feedback" style="margin-top:15px; padding:15px; border-radius:10px; display:none;"></div>
                    <button id="round2Next" class="btn" onclick="unlockRound(3)" style="width:100%; margin-top:15px; display:none;">Lanjut ke Ronde 3 ‚û°</button>
                </div>
            </div>

            <!-- RONDE 3: Molecular Speed Dating -->
            <div id="round3" class="game-round" style="display: none;">
                <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; border: 3px solid #f5576c; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #f5576c;">‚ö° RONDE 3: Speed Quiz (60 Detik)</h3>
                        <div style="background: #f5576c; color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 1.3em;">
                            <span id="round3Timer">60</span>s
                        </div>
                    </div>
                    <p style="font-size: 1.1em; color: #555; margin-bottom: 20px;">Jawab sebanyak mungkin dalam 60 detik! Setiap jawaban benar = +10 poin!</p>
                    
                    <div style="background: #ffe0e6; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <div style="font-size: 1.5em; text-align: center; margin-bottom: 10px;">
                            <strong>Score: <span id="speedScore">0</span></strong> | 
                            Benar: <span id="speedCorrect">0</span> | 
                            Salah: <span id="speedWrong">0</span>
                        </div>
                    </div>
                    
                    <div id="speedQuizArea" style="background: #f8f9fa; padding: 30px; border-radius: 10px; min-height: 200px;">
                        <div id="speedQuestion" style="font-size: 1.3em; font-weight: bold; color: #333; margin-bottom: 20px; text-align: center;">
                            Klik "Mulai" untuk memulai!
                        </div>
                        <div id="speedChoices" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <!-- Dynamically filled -->
                        </div>
                    </div>
                    
                    <button id="startSpeedQuiz" class="btn" onclick="startSpeedQuiz()" style="width: 100%; font-size: 1.2em; margin-top: 15px;">üöÄ Mulai Speed Quiz!</button>
                    <div id="round3Feedback" style="margin-top: 15px; padding: 15px; border-radius: 10px; display: none;"></div>
                    <button id="round3Next" class="btn" onclick="unlockRound(4)" style="width: 100%; margin-top: 15px; display: none;">Lanjut ke Ronde 4 ‚û°</button>
                </div>
            </div>

            <!-- RONDE 4: Pattern Decoder -->
            <div id="round4" class="game-round" style="display: none;">
                <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; border: 3px solid #ffc107; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: #ffc107; margin-bottom: 15px;">üîê RONDE 4: Dekode Pesan Rahasia</h3>
                    <p style="font-size: 1.1em; color: #555; margin-bottom: 20px;">Professor Alkana meninggalkan pesan rahasia! Dekode menggunakan rumus alkana!</p>
                    
                    <div style="background: #fff9e6; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px dashed #ffc107;">
                        <div style="font-family: 'Courier New', monospace; font-size: 1.3em; text-align: center; line-height: 2;">
                            <div>Pesan Terenkripsi:</div>
                            <div style="font-size: 1.5em; color: #333; font-weight: bold; margin: 15px 0;" id="encryptedMessage">
                                C‚ÇÅH? C‚ÇÇH? C‚ÇÉH? C‚ÇÑH? C‚ÇÖH?
                            </div>
                        </div>
                    </div>
                    
                    <p style="color: #666; font-style: italic; text-align: center; margin: 15px 0;">üí° Hint: Setiap ? adalah jumlah H. Gunakan rumus C‚ÇôH‚ÇÇ‚Çô‚Çä‚ÇÇ</p>
                    
                    <div style="margin: 20px 0;">
                        <label style="display: block; font-weight: bold; margin-bottom: 10px;">Masukkan kode lengkap (pisahkan dengan spasi):</label>
                        <input type="text" id="decodeInput" placeholder="Isi jawaban Anda di sini" style="width: 100%; padding: 15px; font-size: 1.2em; border: 2px solid #ffc107; border-radius: 10px;">
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn" onclick="checkDecode()" style="flex: 1; font-size: 1.2em; background: #ffc107; color: #000;">üîì Dekode Pesan!</button>
                        <button class="btn" onclick="showDecodeHint()" style="background: #17a2b8; color: white; padding: 15px 25px; font-size: 1.1em;">üí° Bantuan</button>
                    </div>
                    <div id="round4Hint" style="display: none; background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #17a2b8;">
                        <strong>üí° Ingat Konsep Alkana:</strong><br>
                        Rumus umum alkana adalah <strong>CnH2n+2</strong><br>
                        ‚Ä¢ Untuk C‚ÇÅ: H = 2(1) + 2 = 4<br>
                        ‚Ä¢ Untuk C‚ÇÇ: H = 2(2) + 2 = 6<br>
                        ‚Ä¢ Untuk C‚ÇÉ: H = 2(3) + 2 = 8<br>
                        Lanjutkan pola ini untuk C‚ÇÑ dan C‚ÇÖ!
                    </div>
                    <div id="round4Feedback" style="margin-top: 15px; padding: 15px; border-radius: 10px; display: none;"></div>
                    <button id="round4Next" class="btn" onclick="unlockRound(5)" style="width: 100%; margin-top: 15px; display: none;">Lanjut ke Ronde 5 ‚û°</button>
                </div>
            </div>

            <!-- RONDE 5: Escape Room Chemistry -->
            <div id="round5" class="game-round" style="display: none;">
                <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; border: 3px solid #9c27b0; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #9c27b0;">üö™ RONDE 5: Escape Room - Keluar dari Lab!</h3>
                        <div style="background: #9c27b0; color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 1.3em;">
                            <span id="round5Timer">600</span>s
                        </div>
                    </div>
                    <p style="font-size: 1.1em; color: #555; margin-bottom: 20px;">Selesaikan 3 puzzle untuk keluar dari lab dalam 10 menit!</p>
                    
                    <div style="background: #f3e5f5; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <div style="display: flex; justify-content: space-around; text-align: center;">
                            <div><span id="puzzle1Status" style="font-size: 2em;">üîí</span><div>Puzzle 1</div></div>
                            <div><span id="puzzle2Status" style="font-size: 2em;">üîí</span><div>Puzzle 2</div></div>
                            <div><span id="puzzle3Status" style="font-size: 2em;">üîí</span><div>Puzzle 3</div></div>
                        </div>
                    </div>
                    
                    <div id="escapeRoomPuzzle" style="background: #f8f9fa; padding: 30px; border-radius: 10px; min-height: 250px;">
                        <!-- Puzzle content akan dimuat dinamis -->
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button id="startEscapeRoom" class="btn" onclick="startEscapeRoom()" style="flex: 1; font-size: 1.2em; background: #9c27b0;">üîì Mulai Escape Room!</button>
                        <button class="btn" onclick="showEscapeHint()" style="background: #17a2b8; color: white; padding: 15px 25px; font-size: 1.1em;">üí° Bantuan</button>
                    </div>
                    <div id="round5Hint" style="display: none; background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #17a2b8;">
                        <strong>üí° Konsep Penting:</strong><br>
                        <strong>Rumus Alkana: CnH2n+2</strong><br>
                        ‚Ä¢ n = jumlah atom Karbon (C)<br>
                        ‚Ä¢ Jumlah Hidrogen (H) = 2 √ó n + 2<br>
                        <br>
                        <strong>Contoh:</strong><br>
                        ‚Ä¢ C‚ÇÖ: H = 2(5) + 2 = 12 ‚Üí C‚ÇÖH‚ÇÅ‚ÇÇ<br>
                        ‚Ä¢ C‚Çà: H = 2(8) + 2 = 18 ‚Üí C‚ÇàH‚ÇÅ‚Çà<br>
                        <br>
                        Gunakan pola ini untuk semua puzzle!
                    </div>
                    <div id="round5Feedback" style="margin-top: 15px; padding: 15px; border-radius: 10px; display: none;"></div>
                    <button id="round5Next" class="btn" onclick="unlockRound(6)" style="width: 100%; margin-top: 15px; display: none;">Lanjut ke BOSS BATTLE ‚û°</button>
                </div>
            </div>

            <!-- RONDE 6: Boss Battle -->
            <div id="round6" class="game-round" style="display: none;">
                <div style="background: linear-gradient(135deg, #f5576c 0%, #ff6b81 100%); padding: 25px; border-radius: 15px; margin: 20px 0; border: 3px solid #d32f2f; box-shadow: 0 8px 25px rgba(213, 47, 47, 0.4);">
                    <h3 style="color: white; margin-bottom: 15px; text-align: center; font-size: 1.8em;">‚öîÔ∏è BOSS BATTLE: Professor Alkana!</h3>
                    <p style="color: white; font-size: 1.1em; text-align: center; margin-bottom: 20px;">Kalahkan Professor Alkana dalam pertarungan pengetahuan!</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 3em;">üßë‚Äçüî¨</div>
                            <div style="font-weight: bold; font-size: 1.2em; margin: 10px 0;">Kamu</div>
                            <div id="playerHealthBg" style="background: #e8f5e9; height: 20px; border-radius: 10px; overflow: hidden; position: relative; transition: 0.5s;">
                                <div id="playerHealth" style="width: 100%; height: 100%; background: linear-gradient(90deg, #66bb6a, #4caf50); transition: 0.5s;"></div>
                            </div>
                            <div style="margin-top: 5px; font-weight: bold;">Health: <span id="playerHealthPercent">100</span>%</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 3em;">üßô‚Äç‚ôÇÔ∏è</div>
                            <div style="font-weight: bold; font-size: 1.2em; margin: 10px 0;">Prof. Alkana</div>
                            <div id="bossHealthBg" style="background: #ffebee; height: 20px; border-radius: 10px; overflow: hidden; position: relative; transition: 0.5s;">
                                <div id="bossHealth" style="width: 100%; height: 100%; background: linear-gradient(90deg, #e57373, #f44336); transition: 0.5s;"></div>
                            </div>
                            <div style="margin-top: 5px; font-weight: bold;">Health: <span id="bossHealthPercent">100</span>%</div>
                        </div>
                    </div>
                    
                    <div id="bossStage" style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; min-height: 200px;">
                        <h4 style="color: #d32f2f; text-align: center;">Klik "Mulai Battle" untuk memulai!</h4>
                    </div>
                    
                    <!-- Power-ups dihapus sesuai permintaan -->
                    
                    <button id="startBossBattle" class="btn" onclick="startBossBattle()" style="width: 100%; font-size: 1.3em; background: #d32f2f; color: white;">‚öîÔ∏è MULAI BATTLE!</button>
                    <div id="round6Feedback" style="margin-top: 15px; padding: 15px; border-radius: 10px; display: none;"></div>
                    <button id="round6Next" class="btn" onclick="showGrandFinale()" style="width: 100%; margin-top: 15px; display: none; background: #FFD700; color: #000;">üèÜ KLAIM KEMENANGAN ‚û°</button>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" onclick="goToPhase(4)">‚¨Ö Kembali ke Analisis</button>
                <button class="btn" onclick="goToPhase(6)">Lanjut ke Kesimpulan ‚û°</button>
            </div>
        </div>

        <!-- FASE 6: GENERALIZATION -->
        <div class="phase" id="phase6">
            <div class="phase-header">
                <h2>üéì Fase 6: Generalization (Menarik Kesimpulan)</h2>
                <p>Kesimpulan Akhir</p>
            </div>

            <div class="instructions">
                <h3>Petunjuk Penggunaan</h3>
                <ul>
                    <li>Tuangkan semua yang telah Anda pelajari ke dalam kesimpulan yang jelas</li>
                    <li>Isi kedua kolom kesimpulan berdasarkan hasil eksplorasi Anda</li>
                    <li>Tuliskan dengan bahasa Anda sendiri (tidak perlu menyalin persis)</li>
                    <li>Masukkan nama Anda untuk sertifikat</li>
                    <li>Klik "Dapatkan Sertifikat Ilmuwan Alkana" untuk mendapatkan penghargaan</li>
                    <li>Simpan atau screenshot sertifikat Anda sebagai bukti penyelesaian</li>
                </ul>
            </div>

            <h3>üìù Formulir Kesimpulan</h3>

            <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 5px solid #ffc107;">
                <h4 style="color: #856404; margin-bottom: 10px;">üí° Tips Menulis Kesimpulan:</h4>
                <p style="color: #856404;">
                    ‚Ä¢ Gunakan bahasa Anda sendiri berdasarkan apa yang Anda amati<br>
                    ‚Ä¢ Tuliskan dengan jelas dan lengkap<br>
                    ‚Ä¢ Pastikan kesimpulan menjawab pertanyaan di Fase 2
                </p>
            </div>

            <div style="background: white; padding: 25px; border: 2px solid #667eea; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: #d63031; margin-bottom: 15px;">1Ô∏è‚É£ Kesimpulan tentang Ciri-Ciri Alkana</h4>
                <p style="color: #555; margin-bottom: 10px;">Berdasarkan pengamatan terhadap model molekul dan struktur alkana, apa saja ciri-ciri alkana?</p>
                <textarea id="conclusion1" placeholder="Tuliskan kesimpulan Anda tentang ciri-ciri alkana..."></textarea>
            </div>

            <div style="background: white; padding: 25px; border: 2px solid #667eea; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: #0984e3; margin-bottom: 15px;">2Ô∏è‚É£ Kesimpulan tentang Rumus Umum Alkana</h4>
                <p style="color: #555; margin-bottom: 10px;">Berdasarkan analisis pola data dan grafik, apa rumus umum alkana?</p>
                <textarea id="conclusion2" placeholder="Tuliskan kesimpulan Anda tentang rumus umum alkana..."></textarea>
            </div>

            <div style="background: white; padding: 25px; border: 2px solid #667eea; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: #667eea; margin-bottom: 15px;">üë§ Nama Anda</h4>
                <input type="text" id="studentName" placeholder="Masukkan nama lengkap Anda" style="width: 100%; padding: 15px; font-size: 1.1em; border: 2px solid #667eea; border-radius: 5px;">
            </div>

            <div id="alertBox" class="alert-box">
                Mohon lengkapi semua kolom kesimpulan dan nama Anda!
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="btn" onclick="generateCertificate()" style="font-size: 1.2em; padding: 15px 40px;">
                    üèÜ Dapatkan Sertifikat Ilmuwan Alkana
                </button>
            </div>

            <div id="certificateContainer" style="display: none;">
                <div class="certificate" id="certificate">
                    <h2>üèÜ SERTIFIKAT PENGHARGAAN üèÜ</h2>
                    <p style="font-size: 1.5em; margin: 20px 0;">Diberikan kepada:</p>
                    <p class="name" id="certName">NAMA SISWA</p>
                    <p style="font-size: 1.2em; margin: 20px 0;">
                        Telah berhasil menyelesaikan eksplorasi dan menemukan<br>
                        <strong>Ciri-Ciri dan Rumus Umum Alkana</strong><br>
                        melalui metode Discovery Learning
                    </p>
                    
                    <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 15px; margin: 25px 0; border: 3px solid #d63031;">
                        <p style="font-size: 1.4em; font-weight: bold; margin: 10px 0; color: #2d3436;">üìä Hasil Pencapaian</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                            <div style="background: white; padding: 15px; border-radius: 10px;">
                                <div style="font-size: 2em; font-weight: bold; color: #0984e3;" id="certPercentage">0%</div>
                                <div style="font-size: 0.9em; color: #636e72;">Tingkat Keberhasilan</div>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px;">
                                <div style="font-size: 2em; font-weight: bold; color: #00b894;" id="certGrade">-</div>
                                <div style="font-size: 0.9em; color: #636e72;">Nilai Akhir</div>
                            </div>
                        </div>
                        <p style="font-size: 0.95em; color: #2d3436; margin-top: 10px;">
                            <strong id="certScore">0/0</strong> jawaban benar dalam 6 ronde tantangan
                        </p>
                    </div>
                    
                    <p style="margin: 20px 0;">
                        <strong>Alkana Explorer</strong><br>
                        Hidrokarbon Sederhana
                    </p>
                    <p style="font-size: 0.9em; color: #636e72;">Tanggal: <span id="certDate"></span></p>
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #d63031;">
                        <p style="font-style: italic; color: #636e72;">
                            "Ilmuwan sejati menemukan pengetahuan melalui eksplorasi dan observasi"
                        </p>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn" onclick="downloadCertificate()">üì• Unduh Sertifikat (PNG)</button>
                    <button class="btn btn-secondary" onclick="printCertificate()">üñ®Ô∏è Cetak / Simpan PDF</button>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" onclick="goToPhase(5)">‚¨Ö Kembali ke Verifikasi</button>
                <button class="btn" onclick="goToPhase(1)">üîÑ Mulai dari Awal</button>
            </div>
        </div>
    </div>

    <script>
        // Data alkana
        const alkaneData = {
            methane: { name: 'Metana', formula: 'CH‚ÇÑ', c: 1, h: 4 },
            ethane: { name: 'Etana', formula: 'C‚ÇÇH‚ÇÜ', c: 2, h: 6 },
            propane: { name: 'Propana', formula: 'C‚ÇÉH‚Çà', c: 3, h: 8 },
            butane: { name: 'Butana', formula: 'C‚ÇÑH‚ÇÅ‚ÇÄ', c: 4, h: 10 },
            pentane: { name: 'Pentana', formula: 'C‚ÇÖH‚ÇÅ‚ÇÇ', c: 5, h: 12 },
            hexane: { name: 'Heksana', formula: 'C‚ÇÜH‚ÇÅ‚ÇÑ', c: 6, h: 14 },
            heptane: { name: 'Heptana', formula: 'C‚ÇáH‚ÇÅ‚ÇÜ', c: 7, h: 16 },
            octane: { name: 'Oktana', formula: 'C‚ÇàH‚ÇÅ‚Çà', c: 8, h: 18 },
            nonane: { name: 'Nonana', formula: 'C‚ÇâH‚ÇÇ‚ÇÄ', c: 9, h: 20 },
            decane: { name: 'Dekana', formula: 'C‚ÇÅ‚ÇÄH‚ÇÇ‚ÇÇ', c: 10, h: 22 }
        };

        let collectedData = [];
        
        // Variabel untuk visualisasi 3D
        let canvas3D, ctx3D;
        let rotationX = 0.5;
        let rotationY = 0.5;
        let isDragging = false;
        let lastMouseX, lastMouseY;
        let currentMolecule = null;
        let autoRotate = true;
        let animationFrame;
        let zoomLevel = 0.85;
        let rotationSpeed = 0.008;

        // Struktur 3D molekul
        const molecule3DStructures = {
            methane: {
                atoms: [
                    { type: 'C', x: 0, y: 0, z: 0 },
                    { type: 'H', x: 1, y: 1, z: 1 },
                    { type: 'H', x: -1, y: -1, z: 1 },
                    { type: 'H', x: -1, y: 1, z: -1 },
                    { type: 'H', x: 1, y: -1, z: -1 }
                ],
                bonds: [[0,1], [0,2], [0,3], [0,4]]
            },
            ethane: {
                atoms: [
                    { type: 'C', x: -1.5, y: 0, z: 0 },
                    { type: 'C', x: 1.5, y: 0, z: 0 },
                    { type: 'H', x: -2, y: 1, z: 1 },
                    { type: 'H', x: -2, y: -1, z: 1 },
                    { type: 'H', x: -2, y: 0, z: -1.5 },
                    { type: 'H', x: 2, y: 1, z: 1 },
                    { type: 'H', x: 2, y: -1, z: 1 },
                    { type: 'H', x: 2, y: 0, z: -1.5 }
                ],
                bonds: [[0,1], [0,2], [0,3], [0,4], [1,5], [1,6], [1,7]]
            },
            propane: {
                atoms: [
                    { type: 'C', x: -3, y: 0, z: 0 },
                    { type: 'C', x: 0, y: 0, z: 0 },
                    { type: 'C', x: 3, y: 0, z: 0 },
                    { type: 'H', x: -3.5, y: 1, z: 1 },
                    { type: 'H', x: -3.5, y: -1, z: 1 },
                    { type: 'H', x: -3.5, y: 0, z: -1.5 },
                    { type: 'H', x: 0, y: 1.2, z: 0.8 },
                    { type: 'H', x: 0, y: -1.2, z: 0.8 },
                    { type: 'H', x: 3.5, y: 1, z: 1 },
                    { type: 'H', x: 3.5, y: -1, z: 1 },
                    { type: 'H', x: 3.5, y: 0, z: -1.5 }
                ],
                bonds: [[0,1], [1,2], [0,3], [0,4], [0,5], [1,6], [1,7], [2,8], [2,9], [2,10]]
            },
            butane: {
                atoms: [
                    { type: 'C', x: -4.5, y: 0, z: 0 },
                    { type: 'C', x: -1.5, y: 0, z: 0 },
                    { type: 'C', x: 1.5, y: 0, z: 0 },
                    { type: 'C', x: 4.5, y: 0, z: 0 },
                    { type: 'H', x: -5, y: 1, z: 1 },
                    { type: 'H', x: -5, y: -1, z: 1 },
                    { type: 'H', x: -5, y: 0, z: -1.5 },
                    { type: 'H', x: -1.5, y: 1.2, z: 0.8 },
                    { type: 'H', x: -1.5, y: -1.2, z: 0.8 },
                    { type: 'H', x: 1.5, y: 1.2, z: 0.8 },
                    { type: 'H', x: 1.5, y: -1.2, z: 0.8 },
                    { type: 'H', x: 5, y: 1, z: 1 },
                    { type: 'H', x: 5, y: -1, z: 1 },
                    { type: 'H', x: 5, y: 0, z: -1.5 }
                ],
                bonds: [[0,1], [1,2], [2,3], [0,4], [0,5], [0,6], [1,7], [1,8], [2,9], [2,10], [3,11], [3,12], [3,13]]
            },
            pentane: {
                atoms: [
                    { type: 'C', x: -6, y: 0, z: 0 },
                    { type: 'C', x: -3, y: 0, z: 0 },
                    { type: 'C', x: 0, y: 0, z: 0 },
                    { type: 'C', x: 3, y: 0, z: 0 },
                    { type: 'C', x: 6, y: 0, z: 0 },
                    { type: 'H', x: -6.5, y: 1, z: 1 },
                    { type: 'H', x: -6.5, y: -1, z: 1 },
                    { type: 'H', x: -6.5, y: 0, z: -1.5 },
                    { type: 'H', x: -3, y: 1.2, z: 0.8 },
                    { type: 'H', x: -3, y: -1.2, z: 0.8 },
                    { type: 'H', x: 0, y: 1.2, z: 0.8 },
                    { type: 'H', x: 0, y: -1.2, z: 0.8 },
                    { type: 'H', x: 3, y: 1.2, z: 0.8 },
                    { type: 'H', x: 3, y: -1.2, z: 0.8 },
                    { type: 'H', x: 6.5, y: 1, z: 1 },
                    { type: 'H', x: 6.5, y: -1, z: 1 },
                    { type: 'H', x: 6.5, y: 0, z: -1.5 }
                ],
                bonds: [[0,1], [1,2], [2,3], [3,4], [0,5], [0,6], [0,7], [1,8], [1,9], [2,10], [2,11], [3,12], [3,13], [4,14], [4,15], [4,16]]
            }
        };

        // =====================================================
        // VARIABEL DAN FUNGSI UNTUK GRAFIK INTERAKTIF FASE 4
        // =====================================================
        
        let graphCanvas, graphCtx;
        let userPoints = [];
        let graphPadding = 60;
        let graphMaxX = 10;
        let graphMaxY = 24;
        let isConnected = false;

        // Inisialisasi grafik saat Fase 4 dibuka
        function initializePhase4() {
            console.log('üîÑ Initializing Phase 4 Graph...');
            
            // Tunggu sebentar agar DOM siap
            setTimeout(() => {
                graphCanvas = document.getElementById('graphCanvas');
                if (!graphCanvas) {
                    console.error('‚ùå Graph canvas not found!');
                    return;
                }
                
                graphCtx = graphCanvas.getContext('2d');
                if (!graphCtx) {
                    console.error('‚ùå Could not get 2D context!');
                    return;
                }
                
                // Set proper dimensions
                graphCanvas.width = graphCanvas.offsetWidth;
                graphCanvas.height = graphCanvas.offsetHeight;
                
                console.log('‚úÖ Graph canvas initialized:', graphCanvas.width, 'x', graphCanvas.height);
                
                // Gambar axes
                drawAxes();
                
                // Add event listener
                graphCanvas.addEventListener('click', addPoint);
                
                // Update status
                document.getElementById('plotStatus').textContent = 
                    'Klik pada grafik untuk menempatkan titik data (X = Jumlah C, Y = Jumlah H)';
                    
            }, 100);
        }

        // Fungsi drawAxes yang diperbaiki
        function drawAxes() {
            if (!graphCanvas || !graphCtx) {
                console.error('‚ùå Canvas or context not ready!');
                return;
            }
            
            const width = graphCanvas.width;
            const height = graphCanvas.height;
            
            // Clear canvas dengan background putih
            graphCtx.fillStyle = 'white';
            graphCtx.fillRect(0, 0, width, height);
            
            const scaleX = (width - 2 * graphPadding) / graphMaxX;
            const scaleY = (height - 2 * graphPadding) / graphMaxY;
            
            // Draw border
            graphCtx.strokeStyle = '#667eea';
            graphCtx.lineWidth = 3;
            graphCtx.strokeRect(2, 2, width - 4, height - 4);
            
            // Draw grid
            graphCtx.strokeStyle = '#e0e0e0';
            graphCtx.lineWidth = 1;
            
            // Grid vertikal
            for (let i = 0; i <= graphMaxX; i++) {
                const x = graphPadding + i * scaleX;
                graphCtx.beginPath();
                graphCtx.moveTo(x, graphPadding);
                graphCtx.lineTo(x, height - graphPadding);
                graphCtx.stroke();
            }
            
            // Grid horizontal
            for (let i = 0; i <= graphMaxY; i += 2) {
                const y = height - graphPadding - i * scaleY;
                graphCtx.beginPath();
                graphCtx.moveTo(graphPadding, y);
                graphCtx.lineTo(width - graphPadding, y);
                graphCtx.stroke();
            }
            
            // Draw main axes
            graphCtx.strokeStyle = '#333';
            graphCtx.lineWidth = 2;
            
            // X axis
            graphCtx.beginPath();
            graphCtx.moveTo(graphPadding, height - graphPadding);
            graphCtx.lineTo(width - graphPadding, height - graphPadding);
            graphCtx.stroke();
            
            // Y axis
            graphCtx.beginPath();
            graphCtx.moveTo(graphPadding, graphPadding);
            graphCtx.lineTo(graphPadding, height - graphPadding);
            graphCtx.stroke();
            
            // Draw labels
            graphCtx.fillStyle = '#333';
            graphCtx.font = 'bold 14px Arial';
            graphCtx.textAlign = 'center';
            
            // X axis label
            graphCtx.fillText('Jumlah Atom Karbon (C)', width / 2, height - 15);
            
            // Y axis label (rotated)
            graphCtx.save();
            graphCtx.translate(20, height / 2);
            graphCtx.rotate(-Math.PI / 2);
            graphCtx.fillText('Jumlah Atom Hidrogen (H)', 0, 0);
            graphCtx.restore();
            
            // Draw axis numbers
            graphCtx.font = '12px Arial';
            
            // X axis numbers
            for (let i = 0; i <= graphMaxX; i++) {
                const x = graphPadding + i * scaleX;
                graphCtx.fillText(i, x, height - graphPadding + 20);
            }
            
            // Y axis numbers
            for (let i = 0; i <= graphMaxY; i += 2) {
                const y = height - graphPadding - i * scaleY;
                graphCtx.fillText(i, graphPadding - 20, y + 5);
            }
            
            console.log('‚úÖ Axes drawn successfully');
        }

        function addPoint(event) {
            if (isConnected) return; // Tidak bisa tambah titik setelah di-connect
            
            const rect = graphCanvas.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const clickY = event.clientY - rect.top;
            
            const scaleX = (graphCanvas.width - 2 * graphPadding) / graphMaxX;
            const scaleY = (graphCanvas.height - 2 * graphPadding) / graphMaxY;
            
            // Konversi koordinat pixel ke koordinat grafik
            let dataX = Math.round((clickX - graphPadding) / scaleX);
            let dataY = Math.round((graphCanvas.height - graphPadding - clickY) / scaleY);
            
            // Batasi dalam range
            dataX = Math.max(0, Math.min(graphMaxX, dataX));
            dataY = Math.max(0, Math.min(graphMaxY, dataY));
            
            // Tambahkan titik
            userPoints.push({ x: dataX, y: dataY });
            
            // Update status
            document.getElementById('plotStatus').textContent = 
                `${userPoints.length} titik telah ditempatkan. Klik lagi untuk menambah titik.`;
            
            // Tampilkan tombol connect jika ada minimal 2 titik
            if (userPoints.length >= 2) {
                document.getElementById('connectBtn').style.display = 'inline-block';
            }
            
            // Gambar ulang
            drawAxes();
            drawPoints();
        }

        function drawPoints() {
            const scaleX = (graphCanvas.width - 2 * graphPadding) / graphMaxX;
            const scaleY = (graphCanvas.height - 2 * graphPadding) / graphMaxY;
            
            userPoints.forEach((point, index) => {
                const x = graphPadding + point.x * scaleX;
                const y = graphCanvas.height - graphPadding - point.y * scaleY;
                
                // Gambar titik
                graphCtx.fillStyle = '#f5576c';
                graphCtx.beginPath();
                graphCtx.arc(x, y, 7, 0, 2 * Math.PI);
                graphCtx.fill();
                
                graphCtx.strokeStyle = '#fff';
                graphCtx.lineWidth = 2;
                graphCtx.stroke();
                
                // Label titik
                graphCtx.fillStyle = '#333';
                graphCtx.font = 'bold 11px Arial';
                graphCtx.textAlign = 'left';
                graphCtx.fillText(`(${point.x},${point.y})`, x + 10, y - 10);
            });
        }

        function connectPoints() {
            if (userPoints.length < 2) {
                alert('Tambahkan minimal 2 titik terlebih dahulu!');
                return;
            }
            
            isConnected = true;
            
            // Urutkan titik berdasarkan X
            userPoints.sort((a, b) => a.x - b.x);
            
            // ANALISIS: Cek apakah benar-benar garis lurus dengan regresi linear
            const analysis = analyzeLinearity();
            
            const scaleX = (graphCanvas.width - 2 * graphPadding) / graphMaxX;
            const scaleY = (graphCanvas.height - 2 * graphPadding) / graphMaxY;
            
            // Gambar garis
            graphCtx.strokeStyle = '#667eea';
            graphCtx.lineWidth = 3;
            graphCtx.beginPath();
            
            userPoints.forEach((point, index) => {
                const x = graphPadding + point.x * scaleX;
                const y = graphCanvas.height - graphPadding - point.y * scaleY;
                
                if (index === 0) {
                    graphCtx.moveTo(x, y);
                } else {
                    graphCtx.lineTo(x, y);
                }
            });
            
            graphCtx.stroke();
            
            // Sembunyikan tombol connect
            document.getElementById('connectBtn').style.display = 'none';
            
            // Update status dengan hasil analisis
            document.getElementById('plotStatus').innerHTML = analysis.statusMessage;
            
            // Tampilkan pesan pattern dengan hasil analisis
            showPatternAnalysis(analysis);

            // Jika persamaan sesuai pola alkana (m‚âà2, b‚âà2) munculkan Aha moment
            if (Math.abs(analysis.slope - 2) < 0.15 && Math.abs(analysis.intercept - 2) < 0.5) {
                const aha = document.getElementById('ahaMessage');
                if (aha) aha.style.display = 'block';
            }
        }

        function analyzeLinearity() {
            const n = userPoints.length;
            
            // Hitung slope (m) dan intercept (b) dengan least squares regression
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
            
            userPoints.forEach(point => {
                sumX += point.x;
                sumY += point.y;
                sumXY += point.x * point.y;
                sumX2 += point.x * point.x;
            });
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            // Hitung R¬≤ (coefficient of determination)
            const meanY = sumY / n;
            let ssTotal = 0, ssResidual = 0;
            
            userPoints.forEach(point => {
                const predictedY = slope * point.x + intercept;
                ssTotal += Math.pow(point.y - meanY, 2);
                ssResidual += Math.pow(point.y - predictedY, 2);
            });
            
            const rSquared = 1 - (ssResidual / ssTotal);
            
            // Kriteria Profesional:
            // R¬≤ ‚â• 0.98 = Garis lurus sempurna (excellent linearity)
            // R¬≤ ‚â• 0.90 = Garis lurus sangat baik (very good linearity)
            // R¬≤ ‚â• 0.80 = Mendekati garis lurus (acceptable linearity)
            // R¬≤ < 0.80 = TIDAK membentuk garis lurus (poor linearity - MISKONSEPSI!)
            
            let pattern = '';
            let isLinear = false;
            let statusMessage = '';
            let quality = '';
            let warningLevel = 'success'; // success, warning, danger
            
            if (rSquared >= 0.98) {
                pattern = 'garis lurus sempurna';
                isLinear = true;
                quality = 'excellent';
                warningLevel = 'success';
                statusMessage = `<span style="color: #28a745; font-weight: bold;">‚úÖ SEMPURNA! Data membentuk <strong>garis lurus sempurna</strong> (R¬≤ = ${rSquared.toFixed(4)})</span>`;
            } else if (rSquared >= 0.90) {
                pattern = 'garis lurus sangat baik';
                isLinear = true;
                quality = 'very good';
                warningLevel = 'success';
                statusMessage = `<span style="color: #28a745; font-weight: bold;">‚úÖ BAGUS! Data membentuk <strong>garis lurus yang sangat baik</strong> (R¬≤ = ${rSquared.toFixed(4)})</span>`;
            } else if (rSquared >= 0.80) {
                pattern = 'mendekati garis lurus';
                isLinear = true;
                quality = 'acceptable';
                warningLevel = 'warning';
                statusMessage = `<span style="color: #ff9800; font-weight: bold;">‚ö†Ô∏è PERIKSA! Data <strong>mendekati garis lurus</strong> tapi tidak sempurna (R¬≤ = ${rSquared.toFixed(4)}). Ada sedikit penyimpangan.</span>`;
            } else {
                pattern = 'TIDAK membentuk garis lurus';
                isLinear = false;
                quality = 'poor';
                warningLevel = 'danger';
                statusMessage = `<span style="color: #f44336; font-weight: bold;">‚ùå MISKONSEPSI! Data Anda <strong>TIDAK membentuk garis lurus</strong> (R¬≤ = ${rSquared.toFixed(4)}). Ini salah!</span>`;
            }
            
            // Cek apakah slope mendekati 2 (untuk alkana H = 2C + 2)
            const expectedSlope = 2;
            const expectedIntercept = 2;
            const slopeError = Math.abs(slope - expectedSlope);
            const interceptError = Math.abs(intercept - expectedIntercept);
            const slopeAccurate = slopeError < 0.2;
            const interceptAccurate = interceptError < 0.5;
            
            return {
                slope: slope,
                intercept: intercept,
                rSquared: rSquared,
                pattern: pattern,
                isLinear: isLinear,
                quality: quality,
                warningLevel: warningLevel,
                statusMessage: statusMessage,
                slopeAccurate: slopeAccurate,
                interceptAccurate: interceptAccurate,
                slopeError: slopeError,
                interceptError: interceptError
            };
        }

        function showPatternAnalysis(analysis) {
            const patternMsg = document.getElementById('patternMessage');
            
            if (!analysis.isLinear) {
                // ‚ùå MISKONSEPSI TERDETEKSI - Data TIDAK linear!
                patternMsg.style.background = 'linear-gradient(135deg, #f44336 0%, #e91e63 100%)';
                patternMsg.innerHTML = `
                    <h3 style="color: #fff; margin-bottom: 20px; text-align: center; font-size: 1.7em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                        üö® PERINGATAN: MISKONSEPSI TERDETEKSI! üö®
                    </h3>
                    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.3);">
                        <div style="background: #ffebee; padding: 20px; border-radius: 8px; border-left: 5px solid #f44336; margin-bottom: 20px;">
                            <p style="color: #c62828; font-size: 1.2em; font-weight: bold; margin: 0; line-height: 1.6;">
                                ‚ùå HASIL ANALISIS STATISTIK PROFESIONAL:<br>
                                Data Anda <u>TIDAK MEMBENTUK GARIS LURUS</u>!
                            </p>
                        </div>
                        
                        <div style="background: #fff3e0; padding: 18px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ff6f00;">
                            <p style="color: #e65100; margin: 0; line-height: 1.9; font-size: 1.05em;">
                                <strong>üìä PARAMETER STATISTIK:</strong><br>
                                ‚Ä¢ <strong>Koefisien Determinasi (R¬≤):</strong> <span style="font-size: 1.2em; color: #d32f2f;">${analysis.rSquared.toFixed(4)}</span><br>
                                ‚Ä¢ <strong>Kriteria Minimum Garis Lurus:</strong> R¬≤ ‚â• 0.80<br>
                                ‚Ä¢ <strong>Status Validasi:</strong> <span style="color: #d32f2f; font-weight: bold;">GAGAL - Data tidak linear!</span><br>
                                ‚Ä¢ <strong>Persamaan Regresi:</strong> y = ${analysis.slope.toFixed(3)}x + ${analysis.intercept.toFixed(3)}<br>
                                ‚Ä¢ <strong>Kemiringan (slope):</strong> ${analysis.slope.toFixed(3)} (seharusnya ‚âà 2.0, selisih: ${analysis.slopeError.toFixed(3)})<br>
                                ‚Ä¢ <strong>Intercept:</strong> ${analysis.intercept.toFixed(3)} (seharusnya ‚âà 2.0, selisih: ${analysis.interceptError.toFixed(3)})
                            </p>
                        </div>
                        
                        <div style="background: #e3f2fd; padding: 18px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #1976d2;">
                            <p style="color: #0d47a1; margin: 0; line-height: 1.8; font-size: 1.05em;">
                                <strong>üîç APA ARTI NILAI R¬≤?</strong><br>
                                R¬≤ (koefisien determinasi) mengukur seberapa baik titik-titik Anda membentuk garis lurus:<br>
                                ‚Ä¢ <strong>R¬≤ = 1.00:</strong> Sempurna - semua titik tepat pada garis<br>
                                ‚Ä¢ <strong>R¬≤ ‚â• 0.90:</strong> Sangat baik - titik sangat dekat dengan garis<br>
                                ‚Ä¢ <strong>R¬≤ ‚â• 0.80:</strong> Cukup baik - masih bisa diterima<br>
                                ‚Ä¢ <strong>R¬≤ < 0.80:</strong> <span style="color: #d32f2f; font-weight: bold;">BURUK - titik menyebar, BUKAN garis lurus!</span>
                            </p>
                        </div>
                        
                        <div style="background: #fff9c4; padding: 18px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f57c00;">
                            <p style="color: #e65100; margin: 0; line-height: 1.8; font-size: 1.05em;">
                                <strong>‚ö†Ô∏è KEMUNGKINAN PENYEBAB KESALAHAN:</strong><br><br>
                                <strong>1Ô∏è‚É£ DATA TABEL SALAH (Paling Sering!):</strong><br>
                                ‚Üí Jumlah atom H tidak sesuai rumus C‚ÇôH‚ÇÇ‚Çô‚Çä‚ÇÇ<br>
                                ‚Üí Contoh: Metana (C‚ÇÅ) seharusnya H‚ÇÑ, bukan H‚ÇÉ atau H‚ÇÖ<br><br>
                                
                                <strong>2Ô∏è‚É£ TITIK DIPLOT DI KOORDINAT YANG SALAH:</strong><br>
                                ‚Üí Salah membaca sumbu X (jumlah C) atau Y (jumlah H)<br>
                                ‚Üí Klik tidak tepat pada grid yang sesuai<br><br>
                                
                                <strong>3Ô∏è‚É£ KESALAHAN PERHITUNGAN:</strong><br>
                                ‚Üí Salah menghitung atom pada model 3D di Fase 3<br>
                                ‚Üí Tidak teliti saat mengisi tabel<br><br>
                                
                                <strong>4Ô∏è‚É£ DATA TERCAMPUR:</strong><br>
                                ‚Üí Menggunakan data dari senyawa lain (bukan alkana)<br>
                                ‚Üí Mencampur data alkana dengan alkena/alkuna
                            </p>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: #ffcdd2; border-radius: 8px;">
                            <p style="color: #c62828; font-weight: bold; font-size: 1.15em; margin-bottom: 15px; line-height: 1.6;">
                                ‚ö†Ô∏è <strong>TINDAKAN YANG HARUS DILAKUKAN:</strong><br>
                                Kembali ke <strong>Fase 3</strong> untuk memeriksa dan memperbaiki data tabel Anda,<br>
                                atau klik tombol di bawah untuk reset grafik dan coba lagi!
                            </p>
                            <button class="btn" onclick="resetGraph()" style="width: 100%; background: #f44336; font-size: 1.2em; padding: 18px; box-shadow: 0 4px 8px rgba(244,67,54,0.3);">
                                üîÑ Reset Grafik dan Perbaiki Data
                            </button>
                        </div>
                    </div>
                `;
            } else {
                // ‚úÖ Data LINEAR - Lanjutkan analisis
                let bgGradient = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                let statusBg = '#e8f5e9';
                let statusColor = '#2e7d32';
                let statusIcon = '‚úÖ';
                let statusTitle = 'SEMPURNA!';
                
                if (analysis.rSquared >= 0.98) {
                    statusBg = '#e8f5e9';
                    statusColor = '#1b5e20';
                    statusIcon = '‚úÖ';
                    statusTitle = 'SEMPURNA!';
                } else if (analysis.rSquared >= 0.90) {
                    statusBg = '#e8f5e9';
                    statusColor = '#2e7d32';
                    statusIcon = '‚úÖ';
                    statusTitle = 'SANGAT BAIK!';
                } else {
                    statusBg = '#fff3e0';
                    statusColor = '#e65100';
                    statusIcon = '‚ö†Ô∏è';
                    statusTitle = 'CUKUP BAIK (Periksa Kembali)';
                }
                
                let accuracyWarning = '';
                if (!analysis.slopeAccurate || !analysis.interceptAccurate) {
                    accuracyWarning = `
                        <div style="background: #fff9c4; padding: 18px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #ff6f00;">
                            <strong style="color: #e65100; font-size: 1.1em;">‚ö†Ô∏è CATATAN AKURASI DATA:</strong><br>
                            <p style="color: #f57c00; margin: 10px 0 0 0; line-height: 1.8;">
                                ${!analysis.slopeAccurate ? `‚Ä¢ <strong>Kemiringan (slope):</strong> ${analysis.slope.toFixed(4)} (seharusnya ‚âà 2.0, selisih: ${analysis.slopeError.toFixed(4)})<br>` : ''}
                                ${!analysis.interceptAccurate ? `‚Ä¢ <strong>Intercept:</strong> ${analysis.intercept.toFixed(4)} (seharusnya ‚âà 2.0, selisih: ${analysis.interceptError.toFixed(4)})<br>` : ''}
                                <br><em style="color: #d84315;">‚ö†Ô∏è Ada penyimpangan dari pola alkana ideal (C‚ÇôH‚ÇÇ‚Çô‚Çä‚ÇÇ).<br>
                                Pastikan data pada tabel <strong>Fase 3</strong> sudah 100% benar sesuai rumus molekul!<br>
                                Jika data benar, penyimpangan kecil masih dapat diterima.</em>
                            </p>
                        </div>
                    `;
                }
                
                patternMsg.style.background = bgGradient;
                patternMsg.innerHTML = `
                    <h3 style="color: #fff; margin-bottom: 20px; text-align: center; font-size: 1.6em; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">
                        ${statusIcon} ${statusTitle} - Analisis Pola Data
                    </h3>
                    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);">
                        <div style="background: ${statusBg}; padding: 18px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid ${statusColor};">
                            <strong style="color: ${statusColor}; font-size: 1.15em;">
                                ${statusIcon} HASIL ANALISIS STATISTIK PROFESIONAL:
                            </strong><br>
                            <ul style="color: ${statusColor}; margin: 12px 0 5px 20px; line-height: 2; font-size: 1.05em;">
                                <li><strong>Status Validasi:</strong> <span style="font-weight: bold;">DATA VALID - Membentuk ${analysis.pattern}</span></li>
                                <li><strong>Koefisien Determinasi (R¬≤):</strong> <span style="font-size: 1.1em;">${analysis.rSquared.toFixed(4)}</span> 
                                    ${analysis.rSquared >= 0.98 ? '<strong>(SEMPURNA!)</strong>' : analysis.rSquared >= 0.90 ? '<strong>(Sangat Baik)</strong>' : '<strong>(Cukup Baik)</strong>'}
                                </li>
                                <li><strong>Persamaan Regresi Linear:</strong> y = ${analysis.slope.toFixed(4)}x + ${analysis.intercept.toFixed(4)}</li>
                                <li><strong>Kemiringan (slope):</strong> ${analysis.slope.toFixed(4)} ${analysis.slopeAccurate ? '‚úÖ' : '‚ö†Ô∏è'} (target: ‚âà 2.0)</li>
                                <li><strong>Titik Potong (intercept):</strong> ${analysis.intercept.toFixed(4)} ${analysis.interceptAccurate ? '‚úÖ' : '‚ö†Ô∏è'} (target: ‚âà 2.0)</li>
                                <li><strong>Kesimpulan:</strong> Data <strong>KONSISTEN</strong> dengan pola alkana</li>
                            </ul>
                        </div>
                        
                        ${accuracyWarning}
                        
                        <p style="color: #333; font-size: 1.1em; line-height: 1.8; margin: 20px 0 15px 0;">
                            Titik-titik membentuk <strong style="color: #667eea;">${analysis.pattern}</strong>!<br><br>
                            <strong>üîç Coba perhatikan dan pikirkan:</strong><br>
                            ‚Ä¢ Bagaimana hubungan matematis antara jumlah C (sumbu X) dan jumlah H (sumbu Y)?<br>
                            ‚Ä¢ Apakah ada pola yang bisa Anda rumuskan?<br>
                            ‚Ä¢ Jika ada garis lurus, seperti apa persamaannya?<br>
                            ‚Ä¢ Coba tuliskan dalam bentuk <strong>y = ... x + ...</strong>
                        </p>
                        
                        <div style="background: #f3e5f5; padding: 18px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #9c27b0;">
                            <label style="display: block; margin-bottom: 10px; color: #4a148c; font-weight: bold; font-size: 1.1em;">
                                ‚úçÔ∏è Tuliskan Persamaan Garis yang Anda Temukan:
                            </label>
                            <input type="text" id="equationGuess" placeholder="Contoh: y = 2x + 2" 
                                style="width: 100%; padding: 15px; font-size: 1.15em; border: 2px solid #667eea; border-radius: 8px; margin-bottom: 12px; font-family: 'Courier New', monospace;">
                            <button class="btn" onclick="checkEquation()" style="width: 100%; padding: 15px; font-size: 1.1em;">
                                üîç Cek Persamaan Saya
                            </button>
                            <div id="equationFeedback" style="margin-top: 12px;"></div>
                        </div>
                    </div>
                `;
            }
            
            patternMsg.style.display = 'block';
            patternMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function checkEquation() {
            const guess = document.getElementById('equationGuess').value.trim().toLowerCase();
            const feedback = document.getElementById('equationFeedback');
            
            if (!guess) {
                feedback.innerHTML = '<p style="color: #f5576c; font-weight: bold;">‚ö†Ô∏è Silakan tuliskan persamaan terlebih dahulu!</p>';
                return;
            }
            
            // Hapus spasi
            const normalized = guess.replace(/\s/g, '');
            
            // Cek berbagai format yang benar
            const correctPatterns = [
                'y=2x+2',
                'y=2*x+2',
                'y=2(x)+2',
                'h=2c+2',
                'h=2*c+2',
                'h=2n+2',
                'h=2*n+2'
            ];
            
            const isCorrect = correctPatterns.some(pattern => 
                normalized === pattern.replace(/\s/g, '')
            );
            
            if (isCorrect) {
                feedback.innerHTML = '<p style="color: #28a745; font-weight: bold;">‚úÖ Benar! Persamaan Anda tepat!</p>';
                
                // Tampilkan pesan Aha setelah delay
                setTimeout(() => {
                    document.getElementById('ahaMessage').style.display = 'block';
                    document.getElementById('ahaMessage').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 500);
            } else {
                feedback.innerHTML = '<p style="color: #f5576c; font-weight: bold;">‚ùå Belum tepat. Perhatikan: setiap kenaikan 1 pada X, Y naik berapa? Dan berapa nilai Y saat X=0?</p>';
            }
        }

        function resetGraph() {
            userPoints = [];
            isConnected = false;
            
            // Reset canvas
            drawAxes();
            
            // Reset UI
            document.getElementById('plotStatus').textContent = 'Klik pada grafik untuk menempatkan titik data';
            document.getElementById('connectBtn').style.display = 'none';
            document.getElementById('patternMessage').style.display = 'none';
            document.getElementById('ahaMessage').style.display = 'none';
            document.getElementById('equationGuess').value = '';
            document.getElementById('equationFeedback').innerHTML = '';
        }

        // =====================================================
        // NAVIGASI DAN FUNGSI UMUM
        // =====================================================

        // Navigasi antar fase
        function goToPhase(phaseNum) {
            console.log('üîÑ Navigating to Phase', phaseNum);
            
            // Get current active phase
            const currentPhase = document.querySelector('.phase.active');
            let currentPhaseNum = 1;
            if(currentPhase) {
                const match = currentPhase.id.match(/phase(\d+)/);
                if(match) currentPhaseNum = parseInt(match[1], 10);
            }
            
            // Validasi jika mencoba maju ke fase berikutnya
            if(phaseNum > currentPhaseNum) {
                const validation = validatePhaseCompletion(currentPhaseNum);
                if(!validation.valid) {
                    showPhaseValidationError(validation.message);
                    return;
                }
            }
            
            // Sembunyikan semua fase
            document.querySelectorAll('.phase').forEach(phase => {
                phase.classList.remove('active');
            });
            
            // Tampilkan fase yang dipilih
            document.getElementById('phase' + phaseNum).classList.add('active');
            
            // Update progress bar
            const progress = (phaseNum / 6) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = Math.round(progress) + '%';
            
            // Inisialisasi khusus untuk setiap fase
            if (phaseNum === 4) {
                console.log('üìä Initializing Phase 4 Graph System');
                // Tunggu sebentar agar DOM benar-benar ter-render
                setTimeout(() => {
                    initializePhase4();
                }, 300);
            }
            if (phaseNum === 5) {
                // Inisialisasi otomatis tantangan prediksi jika belum
                setTimeout(()=>{ try { initPhase5Challenges(); } catch(err){ console.error('Gagal init Tantangan Fase 5:', err); } }, 300);
            }
            if (phaseNum === 6) {
                // Auto-populate certificate scores if available
                if(window.finalGameScore){
                    const score = window.finalGameScore;
                    document.getElementById('certPercentage').textContent = score.percentage + '%';
                    document.getElementById('certGrade').textContent = score.grade;
                    document.getElementById('certScore').textContent = score.totalCorrect + '/' + score.totalQuestions;
                    
                    // Color code the grade
                    const gradeEl = document.getElementById('certGrade');
                    if(score.grade === 'A') gradeEl.style.color = '#00b894';
                    else if(score.grade === 'B') gradeEl.style.color = '#0984e3';
                    else if(score.grade === 'C') gradeEl.style.color = '#fdcb6e';
                    else gradeEl.style.color = '#d63031';
                }
            }
            
            // Scroll ke atas
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Validasi penyelesaian fase
        function validatePhaseCompletion(phaseNum) {
            if(phaseNum === 1) {
                // Fase 1: Cek apakah sudah submit refleksi
                const nextBtn = document.getElementById('phase1NextBtn');
                if(nextBtn && nextBtn.style.display === 'none') {
                    return { 
                        valid: false, 
                        message: `‚ùå Refleksi Video Belum Disubmit!<br><br>Mohon jawab <strong>semua 4 pertanyaan refleksi</strong> dari kedua video, lalu klik tombol <strong>"‚úì Submit Jawaban Refleksi"</strong>.<br><br>üí° Tonton video dengan seksama dan renungkan pertanyaan yang diberikan.` 
                    };
                }
                return { valid: true };
            }
            else if(phaseNum === 2) {
                // Fase 2: Cek apakah sudah submit rumusan masalah
                const nextBtn = document.getElementById('phase2NextBtn');
                if(nextBtn && nextBtn.style.display === 'none') {
                    return { 
                        valid: false, 
                        message: `‚ùå Rumusan Masalah Belum Disubmit!<br><br>Mohon tuliskan <strong>pertanyaan/masalah</strong> yang Anda temukan dari data tabel alkana, lalu klik tombol <strong>"‚úì Submit Rumusan Masalah"</strong>.<br><br>üí° Perhatikan pola pada jumlah atom C dan H, lalu rumuskan pertanyaan yang menarik.` 
                    };
                }
                return { valid: true };
            }
            else if(phaseNum === 3) {
                // Fase 3: Cek apakah sudah submit
                const nextBtn = document.getElementById('phase3NextBtn');
                if(nextBtn && nextBtn.style.display === 'none') {
                    return { 
                        valid: false, 
                        message: `‚ùå Data Tabel Belum Disubmit!<br><br>Mohon lengkapi <strong>semua tabel data alkana</strong> lalu klik tombol <strong>"‚úì Submit Data Tabel"</strong>.<br><br>üí° Pilih molekul dari dropdown, amati struktur 3D, lalu isi semua kolom pada tabel.` 
                    };
                }
                return { valid: true };
            }
            else if(phaseNum === 4) {
                // Fase 4: Cek apakah sudah submit
                const nextBtn = document.getElementById('phase4NextBtn');
                if(nextBtn && nextBtn.style.display === 'none') {
                    return { 
                        valid: false, 
                        message: `‚ùå Analisis Belum Disubmit!<br><br>Mohon lengkapi:<br>‚Ä¢ Ciri-ciri alkana<br>‚Ä¢ Rumus umum alkana<br><br>Lalu klik tombol <strong>"‚úì Submit Analisis"</strong>.<br><br>üí° Gunakan grafik dan persamaan garis untuk menemukan rumus umum.` 
                    };
                }
                return { valid: true };
            }
            else if(phaseNum === 5) {
                // Fase 5: Validasi semua 6 ronde harus diselesaikan
                // Cek apakah sudah ada finalGameScore (indikasi Round 6 selesai)
                if(!window.finalGameScore) {
                    return { 
                        valid: false, 
                        message: `‚ùå Fase Verifikasi belum selesai!<br><br>Anda harus menyelesaikan <strong>semua 6 ronde tantangan</strong> sebelum melanjutkan ke kesimpulan.<br><br>üìã Checklist:<br>‚úì Ronde 1: Prediksi Jumlah H<br>‚úì Ronde 2: Klasifikasi Alkana<br>‚úì Ronde 3: Kuis Cepat<br>‚úì Ronde 4: Decode Deret<br>‚úì Ronde 5: Escape Room<br>‚úì Ronde 6: Boss Battle` 
                    };
                }
                return { valid: true };
            }
            else if(phaseNum === 6) {
                // Validasi dilakukan di generateCertificate
                return { valid: true };
            }
            
            return { valid: true };
        }
        
        // Tampilkan pesan error validasi fase
        function showPhaseValidationError(message) {
            // Buat overlay peringatan
            const overlay = document.createElement('div');
            overlay.id = 'phaseValidationOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease-out;
            `;
            
            const messageBox = document.createElement('div');
            messageBox.style.cssText = `
                background: white;
                padding: 40px;
                border-radius: 15px;
                max-width: 600px;
                width: 90%;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                text-align: center;
                animation: popScale 0.4s ease-out;
            `;
            
            messageBox.innerHTML = `
                <div style="font-size: 4em; margin-bottom: 20px;">üîí</div>
                <div style="font-size: 1.3em; color: #842029; margin-bottom: 20px; line-height: 1.6;">
                    ${message}
                </div>
                <button class="btn" onclick="closePhaseValidation()" style="font-size: 1.1em; padding: 12px 30px;">
                    ‚úì Mengerti, Kembali Mengisi
                </button>
            `;
            
            overlay.appendChild(messageBox);
            document.body.appendChild(overlay);
            
            // Close on overlay click
            overlay.addEventListener('click', function(e) {
                if(e.target === overlay) {
                    closePhaseValidation();
                }
            });
        }
        
        function closePhaseValidation() {
            const overlay = document.getElementById('phaseValidationOverlay');
            if(overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => overlay.remove(), 300);
            }
        }
        
        // Submit Phase 1 - Stimulation (Refleksi Video)
        function submitPhase1() {
            const q1 = document.getElementById('phase1Q1').value.trim();
            const q2 = document.getElementById('phase1Q2').value.trim();
            const q3 = document.getElementById('phase1Q3').value.trim();
            const q4 = document.getElementById('phase1Q4').value.trim();
            const feedback = document.getElementById('phase1SubmitFeedback');
            
            let errors = [];
            
            if(q1 === '') {
                errors.push('Pertanyaan Video 1 nomor 1');
                document.getElementById('phase1Q1').style.borderColor = '#d63031';
            } else {
                document.getElementById('phase1Q1').style.borderColor = '#667eea';
            }
            
            if(q2 === '') {
                errors.push('Pertanyaan Video 1 nomor 2');
                document.getElementById('phase1Q2').style.borderColor = '#d63031';
            } else {
                document.getElementById('phase1Q2').style.borderColor = '#667eea';
            }
            
            if(q3 === '') {
                errors.push('Pertanyaan Video 2 nomor 1');
                document.getElementById('phase1Q3').style.borderColor = '#d63031';
            } else {
                document.getElementById('phase1Q3').style.borderColor = '#667eea';
            }
            
            if(q4 === '') {
                errors.push('Pertanyaan Video 2 nomor 2');
                document.getElementById('phase1Q4').style.borderColor = '#d63031';
            } else {
                document.getElementById('phase1Q4').style.borderColor = '#667eea';
            }
            
            if(errors.length > 0) {
                feedback.style.display = 'block';
                feedback.style.background = '#f8d7da';
                feedback.style.color = '#842029';
                feedback.style.border = '2px solid #842029';
                feedback.innerHTML = `<strong>‚ùå Refleksi Belum Lengkap!</strong><br><br>
                    Masih ada <strong>${errors.length} pertanyaan</strong> yang belum dijawab:<br>
                    ${errors.map(e => '‚Ä¢ ' + e).join('<br>')}<br><br>
                    üí° Tonton video dengan seksama dan jawab semua pertanyaan refleksi.<br>
                    Kolom yang kosong ditandai dengan border merah.`;
                feedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            // Semua terisi - sukses!
            feedback.style.display = 'block';
            feedback.style.background = '#d4edda';
            feedback.style.color = '#1b5e20';
            feedback.style.border = '2px solid #1b5e20';
            feedback.innerHTML = `<strong>‚úÖ Refleksi Lengkap!</strong><br><br>
                Selamat! Anda telah menonton video dan menjawab semua pertanyaan refleksi.<br>
                Anda sekarang siap melanjutkan ke fase identifikasi masalah.`;
            
            // Sembunyikan tombol submit, tampilkan tombol next
            document.getElementById('phase1SubmitBtn').style.display = 'none';
            document.getElementById('phase1NextBtn').style.display = 'inline-block';
            
            feedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // Submit Phase 2 - Problem Statement
        function submitPhase2() {
            const problemText = document.getElementById('studentProblem').value.trim();
            const feedback = document.getElementById('phase2SubmitFeedback');
            
            if(problemText === '') {
                feedback.style.display = 'block';
                feedback.style.background = '#f8d7da';
                feedback.style.color = '#842029';
                feedback.style.border = '2px solid #842029';
                feedback.innerHTML = `<strong>‚ùå Rumusan Masalah Belum Diisi!</strong><br><br>
                    Mohon tuliskan pertanyaan atau masalah yang Anda temukan dari data alkana.<br><br>
                    üí° Perhatikan pola pada jumlah atom C dan H di tabel, lalu rumuskan pertanyaan yang menarik untuk dijawab.`;
                document.getElementById('studentProblem').style.borderColor = '#d63031';
                feedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            // Validasi minimal panjang jawaban (minimal 10 karakter)
            if(problemText.length < 10) {
                feedback.style.display = 'block';
                feedback.style.background = '#fff3cd';
                feedback.style.color = '#856404';
                feedback.style.border = '2px solid #ffc107';
                feedback.innerHTML = `<strong>‚ö†Ô∏è Rumusan Terlalu Singkat!</strong><br><br>
                    Jawaban Anda terlalu pendek (${problemText.length} karakter).<br>
                    Coba jelaskan lebih detail pertanyaan atau masalah yang Anda temukan.<br><br>
                    üí° Minimal 10 karakter diperlukan untuk rumusan masalah yang baik.`;
                document.getElementById('studentProblem').style.borderColor = '#ffc107';
                feedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            // Sukses!
            feedback.style.display = 'block';
            feedback.style.background = '#d4edda';
            feedback.style.color = '#1b5e20';
            feedback.style.border = '2px solid #1b5e20';
            feedback.innerHTML = `<strong>‚úÖ Rumusan Masalah Diterima!</strong><br><br>
                Pertanyaan Anda: "<em>${problemText}</em>"<br><br>
                Bagus! Anda telah berhasil merumuskan masalah yang akan kita pecahkan bersama.<br>
                Mari kita lanjutkan ke Lab Virtual untuk mengumpulkan lebih banyak data!`;
            
            document.getElementById('studentProblem').style.borderColor = '#28a745';
            
            // Sembunyikan tombol submit, tampilkan tombol next
            document.getElementById('phase2SubmitBtn').style.display = 'none';
            document.getElementById('phase2NextBtn').style.display = 'inline-block';
            
            feedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // Submit Phase 3 - Data Collection
        function submitPhase3() {
            const tableInputs = document.querySelectorAll('#phase3 .table-input');
            let allFilled = true;
            let emptyCount = 0;
            
            tableInputs.forEach(input => {
                if(input.value.trim() === '') {
                    allFilled = false;
                    emptyCount++;
                    input.style.borderColor = '#d63031';
                } else {
                    input.style.borderColor = '#667eea';
                }
            });
            
            const feedback = document.getElementById('phase3SubmitFeedback');
            
            if(!allFilled) {
                feedback.style.display = 'block';
                feedback.style.background = '#f8d7da';
                feedback.style.color = '#842029';
                feedback.style.border = '2px solid #842029';
                feedback.innerHTML = `<strong>‚ùå Tabel Belum Lengkap!</strong><br><br>
                    Masih ada <strong>${emptyCount} kolom kosong</strong> yang harus diisi.<br>
                    üí° Pilih molekul dari dropdown, amati struktur 3D, lalu isi semua kolom pada tabel.<br>
                    Kolom yang kosong ditandai dengan border merah.`;
                feedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            // Semua terisi - sukses!
            feedback.style.display = 'block';
            feedback.style.background = '#d4edda';
            feedback.style.color = '#1b5e20';
            feedback.style.border = '2px solid #1b5e20';
            feedback.innerHTML = `<strong>‚úÖ Data Lengkap!</strong><br><br>
                Selamat! Anda telah berhasil mengumpulkan data untuk semua 10 alkana.<br>
                Anda sekarang dapat melanjutkan ke fase analisis data.`;
            
            // Sembunyikan tombol submit, tampilkan tombol next
            document.getElementById('phase3SubmitBtn').style.display = 'none';
            document.getElementById('phase3NextBtn').style.display = 'inline-block';
            
            feedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // Submit Phase 4 - Data Processing
        function submitPhase4() {
            const characteristicsInput = document.getElementById('characteristicsInput').value.trim();
            const formulaInput = document.getElementById('formulaInput').value.trim();
            const feedback = document.getElementById('phase4SubmitFeedback');
            
            let errors = [];
            
            if(characteristicsInput === '') {
                errors.push('üìù Ciri-ciri alkana belum diisi');
                document.getElementById('characteristicsInput').style.borderColor = '#d63031';
            } else {
                document.getElementById('characteristicsInput').style.borderColor = '#667eea';
            }
            
            if(formulaInput === '') {
                errors.push('‚úçÔ∏è Rumus umum alkana belum diisi');
                document.getElementById('formulaInput').style.borderColor = '#d63031';
            } else {
                document.getElementById('formulaInput').style.borderColor = '#667eea';
            }
            
            if(errors.length > 0) {
                feedback.style.display = 'block';
                feedback.style.background = '#f8d7da';
                feedback.style.color = '#842029';
                feedback.style.border = '2px solid #842029';
                feedback.innerHTML = `<strong>‚ùå Analisis Belum Lengkap!</strong><br><br>
                    ${errors.join('<br>')}<br><br>
                    üí° Pastikan Anda mengisi kedua kolom analisis sebelum melanjutkan.`;
                feedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            // Validasi format rumus (opsional tapi membantu)
            const formulaClean = formulaInput.toUpperCase().replace(/\s+/g, '');
            let isCorrect = false;
            
            // Terima berbagai format: CnH2n+2, CnH2n2, C(n)H(2n+2), dll
            if(formulaClean.includes('CNH2N+2') || formulaClean.includes('CNH2N2') || 
               formulaClean.includes('C(N)H(2N+2)') || formulaClean.includes('CNHN')) {
                isCorrect = true;
            }
            
            feedback.style.display = 'block';
            
            if(isCorrect) {
                feedback.style.background = '#d4edda';
                feedback.style.color = '#1b5e20';
                feedback.style.border = '2px solid #1b5e20';
                feedback.innerHTML = `<strong>‚úÖ Analisis Benar!</strong><br><br>
                    Selamat! Rumus umum alkana yang Anda tuliskan sudah tepat: <strong>CnH2n+2</strong><br>
                    Anda sekarang dapat melanjutkan ke fase verifikasi.`;
            } else {
                feedback.style.background = '#fff3cd';
                feedback.style.color = '#856404';
                feedback.style.border = '2px solid #ffc107';
                feedback.innerHTML = `<strong>‚ö†Ô∏è Analisis Diterima</strong><br><br>
                    Jawaban Anda: <strong>${formulaInput}</strong><br>
                    üí° Periksa kembali rumus Anda. Rumus yang benar adalah <strong>CnH2n+2</strong><br>
                    Anda tetap dapat melanjutkan, tetapi disarankan untuk memperbaiki jawaban.`;
            }
            
            // Sembunyikan tombol submit, tampilkan tombol next
            document.getElementById('phase4SubmitBtn').style.display = 'none';
            document.getElementById('phase4NextBtn').style.display = 'inline-block';
            
            feedback.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Fase 3: Tampilkan alkana yang dipilih
        function displayAlkane() {
            const select = document.getElementById('alkaneSelect');
            const alkane = select.value;
            
            if (!alkane) {
                currentMolecule = null;
                const formula = document.getElementById('alkaneFormula');
                formula.innerHTML = '';
                return;
            }
            
            const data = alkaneData[alkane];
            currentMolecule = alkane;
            
            // Update canvas 3D
            canvas3D = document.getElementById('alkaneCanvas');
            ctx3D = canvas3D.getContext('2d');
            
            // Setup mouse events untuk rotasi
            setupMouseEvents();
            
            // Start auto rotation
            autoRotate = true;
            startAutoRotation();
            
            const formula = document.getElementById('alkaneFormula');
            formula.innerHTML = `<strong>${data.name}</strong>: ${data.formula}<br>
                                <span style="font-size: 0.9em;">Amati struktur 3D molekul dan catat data Anda pada tabel di bawah</span>`;
        }

        function setupMouseEvents() {
            if (!canvas3D) return;
            
            canvas3D.onmousedown = function(e) {
                isDragging = true;
                autoRotate = false; // Stop auto rotation when user interacts
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                canvas3D.style.cursor = 'grabbing';
            };
            
            canvas3D.onmousemove = function(e) {
                if (isDragging) {
                    const deltaX = e.clientX - lastMouseX;
                    const deltaY = e.clientY - lastMouseY;
                    
                    rotationY += deltaX * 0.01;
                    rotationX += deltaY * 0.01;
                    
                    lastMouseX = e.clientX;
                    lastMouseY = e.clientY;
                    
                    render3DMolecule();
                }
            };
            
            canvas3D.onmouseup = function() {
                isDragging = false;
                canvas3D.style.cursor = 'grab';
            };
            
            canvas3D.onmouseleave = function() {
                isDragging = false;
                canvas3D.style.cursor = 'grab';
            };
            
            // Mouse wheel untuk zoom
            canvas3D.onwheel = function(e) {
                e.preventDefault();
                if (e.deltaY < 0) {
                    zoomLevel *= 1.1;
                } else {
                    zoomLevel *= 0.9;
                }
                zoomLevel = Math.max(0.3, Math.min(3, zoomLevel));
                render3DMolecule();
            };
        }

        function render3DMolecule() {
            if (!currentMolecule || !ctx3D) return;
            
            const structure = molecule3DStructures[currentMolecule];
            if (!structure) return;
            
            // Clear canvas
            ctx3D.clearRect(0, 0, canvas3D.width, canvas3D.height);
            
            const centerX = canvas3D.width / 2;
            const centerY = canvas3D.height / 2;
            const scale = 15 * zoomLevel;
            
            // Rotasi dan proyeksi 3D ke 2D
            const projectedAtoms = structure.atoms.map(atom => {
                // Rotasi X
                let y = atom.y * Math.cos(rotationX) - atom.z * Math.sin(rotationX);
                let z = atom.y * Math.sin(rotationX) + atom.z * Math.cos(rotationX);
                
                // Rotasi Y
                let x = atom.x * Math.cos(rotationY) - z * Math.sin(rotationY);
                z = atom.x * Math.sin(rotationY) + z * Math.cos(rotationY);
                
                // Proyeksi perspektif
                const distance = 25;
                const perspective = distance / (distance + z);
                
                return {
                    x: centerX + x * scale * perspective,
                    y: centerY + y * scale * perspective,
                    z: z,
                    type: atom.type,
                    scale: perspective,
                    original: { x: atom.x, y: atom.y, z: atom.z }
                };
            });
            
            // Gambar ikatan
            structure.bonds.forEach(bond => {
                const atom1 = projectedAtoms[bond[0]];
                const atom2 = projectedAtoms[bond[1]];
                
                // Hitung depth rata-rata untuk opacity
                const avgZ = (atom1.z + atom2.z) / 2;
                const opacity = 0.3 + (avgZ + 10) / 30;
                
                // Gradient untuk ikatan
                const gradient = ctx3D.createLinearGradient(atom1.x, atom1.y, atom2.x, atom2.y);
                gradient.addColorStop(0, `rgba(200, 200, 200, ${opacity})`);
                gradient.addColorStop(0.5, `rgba(150, 150, 150, ${opacity})`);
                gradient.addColorStop(1, `rgba(200, 200, 200, ${opacity})`);
                
                // Lebar ikatan berdasarkan depth
                const bondWidth = 3 + atom1.scale * 2;
                
                ctx3D.strokeStyle = gradient;
                ctx3D.lineWidth = bondWidth;
                ctx3D.lineCap = 'round';
                
                // Shadow untuk ikatan
                ctx3D.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx3D.shadowBlur = 5;
                ctx3D.shadowOffsetX = 2;
                ctx3D.shadowOffsetY = 2;
                
                ctx3D.beginPath();
                ctx3D.moveTo(atom1.x, atom1.y);
                ctx3D.lineTo(atom2.x, atom2.y);
                ctx3D.stroke();
            });
            
            ctx3D.shadowColor = 'transparent';
            
            // Urutkan atom berdasarkan z (depth sorting)
            const sortedAtoms = projectedAtoms
                .map((atom, index) => ({ ...atom, index }))
                .sort((a, b) => a.z - b.z);
            
            // Gambar atom dengan shading profesional
            sortedAtoms.forEach(atom => {
                const baseRadius = atom.type === 'C' ? 28 : 20;
                const radius = baseRadius * atom.scale;
                
                // Base color dengan depth-based brightness
                const brightness = 0.6 + (atom.z + 10) / 40;
                
                // Outer glow
                ctx3D.shadowColor = atom.type === 'C' ? 'rgba(44, 62, 80, 0.5)' : 'rgba(255, 255, 255, 0.6)';
                ctx3D.shadowBlur = 15;
                ctx3D.shadowOffsetX = 0;
                ctx3D.shadowOffsetY = 0;
                
                // Main atom sphere dengan gradient radial
                const gradient = ctx3D.createRadialGradient(
                    atom.x - radius * 0.3, 
                    atom.y - radius * 0.3, 
                    radius * 0.1,
                    atom.x, 
                    atom.y, 
                    radius
                );
                
                if (atom.type === 'C') {
                    gradient.addColorStop(0, `rgba(${80*brightness}, ${90*brightness}, ${100*brightness}, 1)`);
                    gradient.addColorStop(0.4, `rgba(${44*brightness}, ${62*brightness}, ${80*brightness}, 1)`);
                    gradient.addColorStop(1, `rgba(${30*brightness}, ${40*brightness}, ${50*brightness}, 1)`);
                } else {
                    // Hidrogen - Putih (sesuai standar CPK)
                    gradient.addColorStop(0, `rgba(${255*brightness}, ${255*brightness}, ${255*brightness}, 1)`);
                    gradient.addColorStop(0.4, `rgba(${240*brightness}, ${240*brightness}, ${240*brightness}, 1)`);
                    gradient.addColorStop(1, `rgba(${200*brightness}, ${200*brightness}, ${200*brightness}, 1)`);
                }
                
                ctx3D.beginPath();
                ctx3D.arc(atom.x, atom.y, radius, 0, 2 * Math.PI);
                ctx3D.fillStyle = gradient;
                ctx3D.fill();
                
                // Specular highlight (glossy effect)
                ctx3D.shadowColor = 'transparent';
                const highlightGradient = ctx3D.createRadialGradient(
                    atom.x - radius * 0.4,
                    atom.y - radius * 0.4,
                    0,
                    atom.x - radius * 0.3,
                    atom.y - radius * 0.3,
                    radius * 0.6
                );
                highlightGradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
                highlightGradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.3)');
                highlightGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                
                ctx3D.beginPath();
                ctx3D.arc(atom.x - radius * 0.3, atom.y - radius * 0.3, radius * 0.4, 0, 2 * Math.PI);
                ctx3D.fillStyle = highlightGradient;
                ctx3D.fill();
                
                // Label atom dengan shadow
                ctx3D.shadowColor = 'rgba(0, 0, 0, 0.8)';
                ctx3D.shadowBlur = 4;
                ctx3D.shadowOffsetX = 1;
                ctx3D.shadowOffsetY = 1;
                
                // Warna label berbeda untuk C dan H
                ctx3D.fillStyle = atom.type === 'C' ? 'white' : '#1a1a1a';
                ctx3D.font = `bold ${radius * 0.9}px Arial`;
                ctx3D.textAlign = 'center';
                ctx3D.textBaseline = 'middle';
                ctx3D.fillText(atom.type, atom.x, atom.y);
            });
            
            // Reset shadow
            ctx3D.shadowColor = 'transparent';
            
            // Draw molecule info
            ctx3D.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx3D.font = 'bold 14px Arial';
            ctx3D.textAlign = 'left';
            const data = alkaneData[currentMolecule];
            if (data) {
                ctx3D.fillText(`Molekul: ${data.name} (${data.formula})`, 15, 25);
            }
        }

        function startAutoRotation() {
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }
            
            function animate() {
                if (autoRotate && currentMolecule) {
                    rotationY += rotationSpeed;
                    rotationX = 0.3 + Math.sin(rotationY * 0.5) * 0.2; // Gentle vertical oscillation
                    render3DMolecule();
                }
                animationFrame = requestAnimationFrame(animate);
            }
            
            animate();
        }

        // Control functions
        function zoomIn() {
            zoomLevel *= 1.2;
            zoomLevel = Math.min(3, zoomLevel);
            render3DMolecule();
        }

        function zoomOut() {
            zoomLevel *= 0.8;
            zoomLevel = Math.max(0.3, zoomLevel);
            render3DMolecule();
        }

        function resetView() {
            rotationX = 0.5;
            rotationY = 0.5;
            zoomLevel = 0.85;
            autoRotate = true;
            document.getElementById('rotateBtn').textContent = '‚è∏Ô∏è';
            render3DMolecule();
        }

        function toggleAutoRotate() {
            autoRotate = !autoRotate;
            const btn = document.getElementById('rotateBtn');
            btn.textContent = autoRotate ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
        }

        // =====================================================
        // FASE 6: SERTIFIKAT
        // =====================================================

        // Fase 6: Generate sertifikat
        function generateCertificate() {
            const name = document.getElementById('studentName').value.trim();
            const conclusion1 = document.getElementById('conclusion1').value.trim();
            const conclusion2 = document.getElementById('conclusion2').value.trim();
            const alertBox = document.getElementById('alertBox');
            
            // Validasi: Semua field harus diisi
            if (!name || !conclusion1 || !conclusion2) {
                alertBox.style.display = 'block';
                alertBox.style.background = '#f8d7da';
                alertBox.style.color = '#842029';
                alertBox.style.padding = '15px';
                alertBox.style.borderRadius = '8px';
                alertBox.style.border = '2px solid #842029';
                alertBox.innerHTML = '<strong>‚ùå Tidak Boleh Kosong!</strong><br>Mohon lengkapi semua kolom kesimpulan dan nama Anda! Tidak ada yang boleh kosong.';
                alertBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                return;
            }
            
            alertBox.style.display = 'none';
            
            // Isi sertifikat
            document.getElementById('certName').textContent = name.toUpperCase();
            
            const today = new Date();
            const dateStr = today.toLocaleDateString('id-ID', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('certDate').textContent = dateStr;
            
            // Populate score data (already populated by goToPhase(6), but ensure consistency)
            if(window.finalGameScore){
                const score = window.finalGameScore;
                document.getElementById('certPercentage').textContent = score.percentage + '%';
                document.getElementById('certGrade').textContent = score.grade;
                document.getElementById('certScore').textContent = score.totalCorrect + '/' + score.totalQuestions;
                
                // Color code the grade
                const gradeEl = document.getElementById('certGrade');
                if(score.grade === 'A') gradeEl.style.color = '#00b894';
                else if(score.grade === 'B') gradeEl.style.color = '#0984e3';
                else if(score.grade === 'C') gradeEl.style.color = '#fdcb6e';
                else gradeEl.style.color = '#d63031';
            } else {
                // Fallback if no score data
                document.getElementById('certPercentage').textContent = '100%';
                document.getElementById('certGrade').textContent = 'A';
                document.getElementById('certScore').textContent = 'Selesai';
            }
            
            // Tampilkan sertifikat
            document.getElementById('certificateContainer').style.display = 'block';
            document.getElementById('certificateContainer').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function printCertificate() {
            window.print();
        }
        
        // Download certificate as PNG
        function downloadCertificate() {
            const cert = document.getElementById('certificate');
            if(!cert) {
                alert('Sertifikat belum di-generate. Silakan isi form terlebih dahulu.');
                return;
            }
            
            // Show loading message
            const loadingMsg = document.createElement('div');
            loadingMsg.id = 'downloadLoading';
            loadingMsg.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 30px 50px; border-radius: 15px; z-index: 10000; font-size: 1.3em;';
            loadingMsg.innerHTML = '‚è≥ Sedang membuat sertifikat...<br><small>Mohon tunggu sebentar</small>';
            document.body.appendChild(loadingMsg);
            
            // Use html2canvas to capture the certificate
            html2canvas(cert, {
                scale: 2,
                backgroundColor: '#ffffff',
                logging: false,
                windowWidth: 1200,
                windowHeight: 800
            }).then(canvas => {
                // Convert to blob
                canvas.toBlob(blob => {
                    // Create download link
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    const studentName = document.getElementById('certName').textContent || 'Sertifikat';
                    const date = new Date().toLocaleDateString('id-ID').replace(/\//g, '-');
                    link.download = `Sertifikat_Alkana_${studentName}_${date}.png`;
                    link.href = url;
                    link.click();
                    
                    // Cleanup
                    URL.revokeObjectURL(url);
                    document.body.removeChild(loadingMsg);
                    
                    // Success message
                    const successMsg = document.createElement('div');
                    successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #00b894; color: white; padding: 20px 30px; border-radius: 10px; z-index: 10001; font-size: 1.1em; box-shadow: 0 5px 15px rgba(0,0,0,0.3);';
                    successMsg.innerHTML = '‚úÖ Sertifikat berhasil diunduh!';
                    document.body.appendChild(successMsg);
                    setTimeout(() => document.body.removeChild(successMsg), 3000);
                }, 'image/png');
            }).catch(err => {
                console.error('Error generating certificate:', err);
                document.body.removeChild(loadingMsg);
                alert('Gagal mengunduh sertifikat. Silakan gunakan tombol Cetak sebagai alternatif.');
            });
        }

        // Print styles
        const style = document.createElement('style');
        style.textContent = `
            @media print {
                @page {
                    size: landscape;
                    margin: 0.5cm;
                }
                body * {
                    visibility: hidden;
                }
                #certificate, #certificate * {
                    visibility: visible;
                }
                #certificate {
                    position: absolute;
                    left: 0;
                    top: 0;
                    width: 100%;
                    page-break-after: avoid;
                }
            }
        `;
        document.head.appendChild(style);

        // Auto-initialize
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM Loaded - Alkana Explorer Ready!');
            
            // Initialize graph system
            setTimeout(() => {
                if (document.getElementById('phase4').classList.contains('active')) {
                    initializePhase4();
                }
            }, 500);
        });
        
        // =====================================================
        // GLOBAL SCORE TRACKING SYSTEM
        // =====================================================
        let gameScore = {
            round1: { correct: 0, total: 3 },      // Prediksi 3 soal
            round2: { correct: 0, total: 3 },      // Klasifikasi 3 soal
            round3: { correct: 0, total: 0 },      // Speed Quiz (dinamis)
            round4: { correct: 0, total: 5 },      // Dekode 5 angka
            round5: { correct: 0, total: 3 },      // Escape Room 3 puzzle
            round6: { correct: 0, total: 0 }       // Boss Battle (dinamis)
        };
        
        function calculateFinalScore(){
            let totalCorrect = 0;
            let totalQuestions = 0;
            
            for(let round in gameScore){
                totalCorrect += gameScore[round].correct;
                totalQuestions += gameScore[round].total;
            }
            
            const percentage = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
            let grade = 'D';
            
            if(percentage >= 70) grade = 'A';
            else if(percentage >= 60) grade = 'B';
            else if(percentage >= 50) grade = 'C';
            else grade = 'D';
            
            return { percentage, grade, totalCorrect, totalQuestions };
        }
        
        // =====================================================
        // FASE 5: Tantangan Prediksi & Klasifikasi (Ronde 1 & 2)
        // =====================================================
        function initPhase5Challenges(){ /* Saat ini tidak butuh inisialisasi khusus */ }
        function evaluatePredictions(){
            const rows = [ {n:6, inputId:'predH6', verifyId:'verify6'}, {n:7, inputId:'predH7', verifyId:'verify7'}, {n:8, inputId:'predH8', verifyId:'verify8'} ];
            let allFilled = true; let correctCount = 0;
            let explanations = [];
            
            // Validasi: Pastikan semua input terisi
            rows.forEach(r=>{
                const raw = document.getElementById(r.inputId).value.trim();
                if(raw === '') {
                    allFilled = false;
                }
            });
            
            if(!allFilled) {
                const fb = document.getElementById('round1Feedback'); 
                fb.style.display='block';
                fb.style.background='#f8d7da'; 
                fb.style.color='#842029'; 
                fb.innerHTML='<strong>‚ùå Tidak Boleh Kosong!</strong><br>Mohon isi semua kolom prediksi terlebih dahulu. Tidak ada yang boleh kosong.';
                return;
            }
            
            // Evaluasi jawaban
            rows.forEach(r=>{
                const raw = document.getElementById(r.inputId).value.trim();
                const val = parseInt(raw,10);
                const expected = 2*r.n + 2;
                const cell = document.getElementById(r.verifyId);
                
                if(isNaN(val)){
                    cell.textContent='Belum diisi'; cell.style.color='#856404'; return;
                }
                if(val===expected){ 
                    cell.textContent='‚úì Benar'; 
                    cell.style.color='#1b5e20'; 
                    correctCount++; 
                }
                else { 
                    cell.textContent='‚úó Salah'; 
                    cell.style.color='#842029'; 
                    explanations.push(`<strong>C${r.n}:</strong> Jawaban Anda ${val}, seharusnya ${expected}. Rumus: H = 2√ó${r.n}+2 = ${expected}`);
                }
            });
            
            const fb = document.getElementById('round1Feedback'); fb.style.display='block';
            // Hitung skor dan beri bintang proporsional (1 per jawaban benar)
            fb.style.background = correctCount===rows.length? '#d4edda':'#fff3cd';
            fb.style.color = correctCount===rows.length? '#1b5e20':'#856404';
            let message = '<strong>Skor Anda: '+correctCount+' dari '+rows.length+' prediksi benar.</strong> ';
            if(correctCount===rows.length){
                message += 'üéâ Sempurna! Semua sesuai pola CnH2n+2.';
            } else {
                message += '<br><br>üí° <strong>Penjelasan kesalahan:</strong><br>' + explanations.join('<br>');
                message += '<br><br>üìå <strong>Ingat:</strong> Rumus alkana adalah CnH2n+2, jadi jumlah H selalu 2√ón + 2.';
            }
            fb.innerHTML = message;
            document.getElementById('round1Next').style.display='block';
            if(correctCount>0){ incrementStars(correctCount); }
            
            // Track score
            gameScore.round1.correct = correctCount;
        }
        function evaluateClassification(){
            const data = [
                { id:'classA', verify:'verifyA', formula:'C5H10' },
                { id:'classB', verify:'verifyB', formula:'C9H20' },
                { id:'classC', verify:'verifyC', formula:'C4H8' }
            ];
            let allSelected=true; let correctCount=0;
            let explanations = [];
            
            // Validasi: Pastikan semua dropdown dipilih
            data.forEach(d=>{
                const sel = document.getElementById(d.id).value;
                if(!sel) {
                    allSelected = false;
                }
            });
            
            if(!allSelected) {
                const fb = document.getElementById('round2Feedback'); 
                fb.style.display='block';
                fb.style.background='#f8d7da'; 
                fb.style.color='#842029'; 
                fb.innerHTML='<strong>‚ùå Tidak Boleh Kosong!</strong><br>Mohon pilih jawaban untuk semua soal. Tidak ada yang boleh kosong.';
                return;
            }
            
            // Evaluasi jawaban
            data.forEach(d=>{
                const sel = document.getElementById(d.id).value;
                const cell = document.getElementById(d.verify);
                const m = d.formula.match(/C(\d+)H(\d+)/); const n=parseInt(m[1],10); const h=parseInt(m[2],10); const isAlkane = (h===2*n+2);
                const should = isAlkane? 'ya':'tidak';
                const expectedH = 2*n+2;
                if(sel===should){ 
                    cell.textContent='‚úì'; 
                    cell.style.color='#1b5e20'; 
                    correctCount++; 
                }
                else { 
                    cell.textContent='‚úó'; 
                    cell.style.color='#842029'; 
                    if(isAlkane){
                        explanations.push(`<strong>${d.formula}:</strong> Ini ALKANA (H = 2√ó${n}+2 = ${expectedH}, sesuai!). Jawaban seharusnya "Ya".`);
                    } else {
                        explanations.push(`<strong>${d.formula}:</strong> Ini BUKAN alkana (H = ${h}, tapi seharusnya ${expectedH} untuk alkana). Jawaban seharusnya "Tidak".`);
                    }
                }
            });
            
            const fb = document.getElementById('round2Feedback'); fb.style.display='block';
            fb.style.background = correctCount===data.length? '#d4edda':'#fff3cd';
            fb.style.color = correctCount===data.length? '#1b5e20':'#856404';
            let message = '<strong>Skor klasifikasi: '+correctCount+' dari '+data.length+' benar.</strong> ';
            if(correctCount===data.length){
                message += 'üéâ Sempurna! Anda memahami klasifikasi alkana.';
            } else {
                message += '<br><br>üí° <strong>Penjelasan kesalahan:</strong><br>' + explanations.join('<br>');
                message += '<br><br>üìå <strong>Cara cek:</strong> Hitung H yang seharusnya (2√ón+2), lalu bandingkan dengan H pada rumus.';
            }
            fb.innerHTML = message;
            document.getElementById('round2Next').style.display='block';
            if(correctCount>0){ incrementStars(correctCount); }
            
            // Track score
            gameScore.round2.correct = correctCount;
        }
        // Shim fungsi lama agar tidak error bila masih dipanggil dari tempat lain
        function checkMolecule3D(){ /* tidak relevan lagi */ }
        function autoFillHydrogen(){ /* tidak relevan */ }
        function showRound1Success(){ /* digantikan oleh evaluatePredictions */ }
        function failBuild(){ /* tidak relevan */ }
        // Simple progression helpers for other rounds
        function unlockRound(n){
            // Sembunyikan semua ronde dalam Fase 5 agar hanya satu tampil sekaligus
            document.querySelectorAll('#phase5 .game-round').forEach(el=>{ el.style.display='none'; });
            document.getElementById('currentRound').textContent=n;
            const target = document.getElementById('round'+n);
            if(target){ target.style.display='block'; target.scrollIntoView({behavior:'smooth', block:'start'}); }
        }
        function incrementStars(n){ const el=document.getElementById('totalStars'); const cur=parseInt(el.textContent||'0',10); el.textContent=cur+n; }
        // =====================================================
        // HINT FUNCTIONS FOR ROUNDS 4 & 5
        // =====================================================
        function showDecodeHint(){
            const hint = document.getElementById('round4Hint');
            if(hint){ hint.style.display = hint.style.display==='none'? 'block':'none'; }
        }
        function showEscapeHint(){
            const hint = document.getElementById('round5Hint');
            if(hint){ hint.style.display = hint.style.display==='none'? 'block':'none'; }
        }
        // =====================================================
        // RONDE 4: DEKODE PESAN RAHASIA IMPLEMENTATION
        // =====================================================
        // Pesan: C1H4 C2H6 C3H8 C4H10 C5H12 (metana sampai pentana) -> ambil huruf pertama nama METANA ETANA PROPANA BUTANA PENTANA => M E P B P
        // Kita ingin siswa menuliskan deret jumlah H yang benar: 4 6 8 10 12.
        // Jika semua benar tampilkan sukses, jika tidak tetap izinkan lanjut dengan feedback skor.
        function checkDecode(){
            const input = document.getElementById('decodeInput');
            const fb = document.getElementById('round4Feedback');
            const nextBtn = document.getElementById('round4Next');
            if(!input||!fb||!nextBtn) return;
            const raw = input.value.trim();
            
            // Validasi: Input tidak boleh kosong
            if(raw===''){
                fb.style.display='block'; 
                fb.style.background='#f8d7da'; 
                fb.style.color='#842029'; 
                fb.innerHTML='<strong>‚ùå Tidak Boleh Kosong!</strong><br>Masukkan lima angka dipisahkan spasi. Tidak boleh kosong.';
                return;
            }
            
            const parts = raw.split(/\s+/);
            // Normalisasi: ambil hanya angka
            const nums = parts.map(p=>parseInt(p,10));
            if(nums.some(isNaN) || nums.length!==5){ 
                fb.style.display='block'; 
                fb.style.background='#f8d7da'; 
                fb.style.color='#842029'; 
                fb.textContent='Format tidak valid. Masukkan tepat 5 angka (contoh: 4 6 8 10 12).'; 
                return; 
            }
            
            const expected = [4,6,8,10,12];
            let correctCount=0;
            nums.forEach((v,i)=>{ if(v===expected[i]) correctCount++; });
            fb.style.display='block';
            if(correctCount===expected.length){
                fb.style.background='#d4edda'; fb.style.color='#1b5e20';
                fb.innerHTML='‚úÖ Dekode benar! Deret H sesuai rumus CnH2n+2. Lanjutkan ke ronde berikutnya.';
                incrementStars(3);
            } else {
                fb.style.background='#fff3cd'; fb.style.color='#856404';
                fb.innerHTML='<strong>Skor: '+correctCount+' / 5 benar.</strong><br>üí° <strong>Ingat rumus alkana CnH2n+2:</strong><br>C‚ÇÅH? ‚Üí H = 2(1)+2 = 4<br>C‚ÇÇH? ‚Üí H = 2(2)+2 = 6<br>C‚ÇÉH? ‚Üí H = 2(3)+2 = 8<br>Lanjutkan pola untuk C‚ÇÑ dan C‚ÇÖ. Coba lagi atau klik Bantuan!';
                if(correctCount>0) incrementStars(1);
            }
            nextBtn.style.display='block';
            
            // Track score
            gameScore.round4.correct = correctCount;
        }
        // =====================================================
        // RONDE 5: ESCAPE ROOM IMPLEMENTATION
        // =====================================================
        let escapeState = { started:false, current:1, solved:0, time:600, timer:null };
        function startEscapeRoom(){
            if(escapeState.started) return;
            escapeState.started=true; escapeState.current=1; escapeState.solved=0; escapeState.time=600;
            updateEscapeTimer();
            document.getElementById('round5Feedback').style.display='none';
            document.getElementById('round5Next').style.display='none';
            loadEscapePuzzle(escapeState.current);
            escapeState.timer = setInterval(()=>{
                escapeState.time--; updateEscapeTimer();
                if(escapeState.time<=0){ endEscapeRoom('Waktu habis'); }
            },1000);
        }
        function updateEscapeTimer(){ const el=document.getElementById('round5Timer'); if(el) el.textContent=escapeState.time; }
        function loadEscapePuzzle(n){
            const container = document.getElementById('escapeRoomPuzzle');
            if(!container) return;
            let html='';
            if(n===1){
                html = `<h4 style="margin-top:0;color:#9c27b0">Puzzle 1: Rumus Alkana</h4>
                        <p>Tuliskan rumus lengkap alkana dengan jumlah karbon <strong>9</strong>.</p>
                        <input id="puzzleInput" type="text" style="width:100%;padding:10px;border:2px solid #9c27b0;border-radius:8px;" />
                        <button class="btn" style="width:100%;margin-top:12px;background:#9c27b0" onclick="checkEscapeAnswer()">Kirim Jawaban</button>`;
            } else if(n===2){
                html = `<h4 style="margin-top:0;color:#9c27b0">Puzzle 2: Hitung Hidrogen</h4>
                        <p>Berapa jumlah atom Hidrogen pada alkana dengan <strong>11</strong> karbon?</p>
                        <input id="puzzleInput" type="number" style="width:100%;padding:10px;border:2px solid #9c27b0;border-radius:8px;" />
                        <button class="btn" style="width:100%;margin-top:12px;background:#9c27b0" onclick="checkEscapeAnswer()">Kirim Jawaban</button>`;
            } else if(n===3){
                html = `<h4 style="margin-top:0;color:#9c27b0">Puzzle 3: Lanjutan Deret</h4>
                        <p>Diberikan deret: CH4, C2H6, C3H8, C4H10, C5H12. Apa rumus selanjutnya?</p>
                        <input id="puzzleInput" type="text" style="width:100%;padding:10px;border:2px solid #9c27b0;border-radius:8px;" />
                        <button class="btn" style="width:100%;margin-top:12px;background:#9c27b0" onclick="checkEscapeAnswer()">Kirim Jawaban</button>`;
            }
            container.innerHTML = html;
        }
        function checkEscapeAnswer(){
            const inp = document.getElementById('puzzleInput');
            const fb = document.getElementById('round5Feedback');
            if(!inp||!fb) return;
            const val = inp.value.trim();
            
            // Validasi: Input tidak boleh kosong
            if(val === '') {
                fb.style.display='block';
                fb.style.background='#f8d7da';
                fb.style.color='#842029';
                fb.innerHTML='<strong>‚ùå Tidak Boleh Kosong!</strong><br>Masukkan jawaban Anda. Tidak boleh kosong.';
                return;
            }
            
            let correct=false; let expected=''; let helpText='';
            if(escapeState.current===1){ 
                expected='C9H20'; 
                correct = (val.toUpperCase()===expected); 
                helpText = 'Gunakan rumus CnH2n+2. Untuk n=9: H = 2(9) + 2 = 20. Jadi C9H20.';
            }
            else if(escapeState.current===2){ 
                expected='24'; 
                correct = (val===expected); 
                helpText = 'Gunakan rumus CnH2n+2. Untuk n=11: H = 2(11) + 2 = 24.';
            }
            else if(escapeState.current===3){ 
                expected='C6H14'; 
                correct = (val.toUpperCase()===expected); 
                helpText = 'Pola deret mengikuti CnH2n+2. Setelah C5H12, lanjutannya C6 dengan H = 2(6)+2 = 14.';
            }
            fb.style.display='block';
            if(correct){
                fb.style.background='#d4edda'; fb.style.color='#1b5e20'; fb.textContent='Benar!';
                markPuzzleSolved(escapeState.current,true);
                incrementStars(1);
                escapeState.solved++;
                if(escapeState.current<3){ escapeState.current++; loadEscapePuzzle(escapeState.current); }
                else { endEscapeRoom('Semua puzzle selesai'); }
            } else {
                fb.style.background='#fff3cd'; fb.style.color='#856404'; 
                fb.innerHTML='<strong>Belum tepat.</strong><br>üí° '+helpText+'<br>Coba lagi!';
                markPuzzleSolved(escapeState.current,false);
            }
        }
        function markPuzzleSolved(n, success){
            const idMap = {1:'puzzle1Status',2:'puzzle2Status',3:'puzzle3Status'};
            const el = document.getElementById(idMap[n]);
            if(!el) return;
            if(success){ el.textContent='‚úÖ'; }
            else { el.textContent='‚ùó'; }
        }
        function endEscapeRoom(reason){
            clearInterval(escapeState.timer); escapeState.timer=null; escapeState.started=false;
            const fb = document.getElementById('round5Feedback'); fb.style.display='block';
            if(reason==='Semua puzzle selesai'){
                fb.style.background='#d4edda'; fb.style.color='#1b5e20'; fb.textContent='Escape Room selesai. Semua puzzle terpecahkan!';
                incrementStars(2); // bonus selesai
            } else {
                fb.style.background='#f8d7da'; fb.style.color='#842029'; fb.textContent='Escape Room berakhir: '+reason+'. Puzzle selesai: '+escapeState.solved+'/3.';
            }
            document.getElementById('round5Next').style.display='block';
            const container = document.getElementById('escapeRoomPuzzle'); if(container) container.innerHTML='<p style="text-align:center;font-weight:bold;">Escape Room berakhir: '+reason+'</p>';
            
            // Track score
            gameScore.round5.correct = escapeState.solved;
        }
        // =====================================================
        // RONDE 6: BOSS BATTLE IMPLEMENTATION
        // =====================================================
    let bossState = { active:false, player:100, boss:100, questionIndex:0, questions:[], time:120, timer:null, correctAnswers:0 };
        function buildBossQuestions(){
            bossState.questions = [
                { q:'Rumus umum alkana adalah?', choices:['CnH2n','CnH2n+2','CnHn+2','CnH2n-2'], correct:1, hint:'Perhatikan penambahan +2 untuk rantai jenuh.' },
                { q:'Berapa H pada alkana n=12?', choices:['24','26','28','30'], correct:1, hint:'2*12+2 = 26.' },
                { q:'C6H14 adalah?', choices:['Alkana','Alkena','Alkuna','Aren'], correct:0, hint:'CnH2n+2 terpenuhi.' },
                { q:'Rumus yang bukan alkana?', choices:['C3H8','C4H10','C5H12','C6H12'], correct:3, hint:'Kurang 2 H untuk memenuhi rumus.' },
                { q:'Nama alkana dengan 10 karbon?', choices:['Nonana','Dekana','Undekana','Oktona'], correct:1, hint:'Prefix deka- untuk 10.' }
            ];
        }
        function startBossBattle(){
            if(bossState.active) return;
            buildBossQuestions();
            bossState.active=true; bossState.player=100; bossState.boss=100; bossState.questionIndex=0; bossState.time=120; bossState.correctAnswers=0;
            bossState.timer = setInterval(()=>{ bossState.time--; updateBossTime(); if(bossState.time<=0){ endBossBattle('Waktu habis'); } },1000);
            renderBossQuestion(); updateBossBars();
            document.getElementById('round6Feedback').style.display='none';
        }
        function updateBossBars(){
            const p = document.getElementById('playerHealth'); const b = document.getElementById('bossHealth');
            const pp = document.getElementById('playerHealthPercent'); const bp = document.getElementById('bossHealthPercent');
            
            if(p){
                p.style.width = bossState.player+'%';
            }
            
            if(b){
                b.style.width = bossState.boss+'%';
            }
            
            if(pp) pp.textContent = bossState.player; if(bp) bp.textContent = bossState.boss;
        }
        function updateBossTime(){ /* optional display could be added */ }
        function renderBossQuestion(){
            const stage = document.getElementById('bossStage'); if(!stage) return;
            if(bossState.questionIndex>=bossState.questions.length){ endBossBattle('Semua soal terjawab'); return; }
            const qObj = bossState.questions[bossState.questionIndex];
            let html = `<h4 style="margin-top:0;color:#d32f2f">Soal ${bossState.questionIndex+1}/${bossState.questions.length}</h4>`;
            html += `<p style="font-weight:bold;">${qObj.q}</p>`;
            html += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">';
            qObj.choices.forEach((c,i)=>{ html += `<button class=\"btn btn-secondary\" onclick=\"answerBoss(${i})\" style=\"padding:10px;\">${c}</button>`; });
            html += '</div>';
            /* Hint dihapus */
            stage.innerHTML = html;
        }
        function answerBoss(choice){
            if(!bossState.active) return;
            const qObj = bossState.questions[bossState.questionIndex];
            const fb = document.getElementById('round6Feedback'); fb.style.display='block';
            
            // Add animation styles if not present
            if(!document.getElementById('healthAnimStyles')){
                const styleEl = document.createElement('style'); 
                styleEl.id = 'healthAnimStyles';
                styleEl.textContent = `
                    @keyframes healthShake {
                        0%, 100% { transform: scale(1); }
                        25% { transform: scaleX(1.05); }
                        50% { transform: scaleX(0.98); }
                        75% { transform: scaleX(1.02); }
                    }
                    @keyframes healthPulse {
                        0% { filter: brightness(1); }
                        50% { filter: brightness(1.3); }
                        100% { filter: brightness(1); }
                    }
                    @keyframes healthReduce {
                        0% { filter: brightness(1.2); }
                        100% { filter: brightness(1); }
                    }
                `;
                document.head.appendChild(styleEl);
            }
            
            if(choice===qObj.correct){
                bossState.boss = Math.max(0, bossState.boss - 20); // benar: boss -20%
                fb.style.background='#d4edda'; fb.style.color='#1b5e20'; fb.textContent='Serangan berhasil! (-20% Boss)';
                
                // Animate boss health bar
                const bossBar = document.getElementById('bossHealth');
                if(bossBar){
                    bossBar.style.animation = 'none';
                    setTimeout(() => {
                        bossBar.style.animation = 'healthShake 0.5s ease, healthReduce 0.5s ease';
                    }, 10);
                }
                
                incrementStars(1);
                bossState.correctAnswers++; // track correct
            } else {
                bossState.player = Math.max(0, bossState.player - 25); // salah: player -25%
                fb.style.background='#f8d7da'; fb.style.color='#842029'; fb.textContent='Serangan meleset! (-25% Kamu)';
                
                // Animate player health bar
                const playerBar = document.getElementById('playerHealth');
                if(playerBar){
                    playerBar.style.animation = 'none';
                    setTimeout(() => {
                        playerBar.style.animation = 'healthShake 0.5s ease, healthReduce 0.5s ease';
                    }, 10);
                }
            }
            bossState.questionIndex++;
            updateBossBars();
            if(bossState.boss<=0){ endBossBattle('Boss dikalahkan'); return; }
            if(bossState.player<=0){ endBossBattle('Player kalah'); return; }
            renderBossQuestion();
        }
        // Fungsi power-up dihapus
        function endBossBattle(reason){
            clearInterval(bossState.timer); bossState.timer=null; bossState.active=false;
            
            // Track score
            gameScore.round6.correct = bossState.correctAnswers;
            gameScore.round6.total = bossState.questionIndex;
            
            const fb = document.getElementById('round6Feedback'); fb.style.display='block';
            if(reason==='Boss dikalahkan'){
                fb.style.background='#d4edda'; fb.style.color='#1b5e20'; fb.textContent='Professor Alkana kalah! Kemenangan!'; incrementStars(3);
                playBossVictoryAnimation();
                // Show scorecard after victory animation
                setTimeout(() => showFinalScorecard(), 1500);
            } else if(reason==='Semua soal terjawab'){
                fb.style.background='#d4edda'; fb.style.color='#1b5e20'; fb.textContent='Semua soal dijawab. Health Boss: '+bossState.boss+'%.'; if(bossState.boss<=25) incrementStars(2);
                playBossVictoryAnimation();
                // Show scorecard after victory animation
                setTimeout(() => showFinalScorecard(), 1500);
            } else if(reason==='Player kalah'){
                fb.style.background='#f8d7da'; fb.style.color='#842029'; fb.textContent='Kamu kalah. Coba ulang untuk skor lebih baik.';
                playBossDefeatAnimation();
            } else if(reason==='Waktu habis'){
                fb.style.background='#f8d7da'; fb.style.color='#842029'; fb.textContent='Waktu habis. Boss masih bertahan.';
                playBossDefeatAnimation();
            }
            const stage = document.getElementById('bossStage'); if(stage) stage.innerHTML='<h4 style="color:#d32f2f;text-align:center;">'+reason+'</h4>';
        }
        function playBossVictoryAnimation(){
            const stage = document.getElementById('bossStage');
            if(!stage) return;
            const overlay = document.createElement('div');
            overlay.style.position='absolute';
            overlay.style.left='0'; overlay.style.top='0'; overlay.style.width='100%'; overlay.style.height='100%';
            overlay.style.pointerEvents='none';
            overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center';
            overlay.style.animation='victoryFlash 1.2s ease-out forwards';
            overlay.innerHTML='<div style="text-align:center;">\n <div style="font-size:3em; animation: popScale 0.8s ease-out forwards;">üèÜ</div>\n <div style="font-size:1.5em; font-weight:bold; color:#1b5e20; margin-top:10px; animation: fadeUp 0.9s ease-out forwards;">KEMENANGAN!</div>\n</div>';
            stage.style.position='relative'; stage.appendChild(overlay);
            // Inject keyframes if not existing
            if(!document.getElementById('bossAnimStyles')){
                const styleEl = document.createElement('style'); styleEl.id='bossAnimStyles';
                styleEl.textContent = `@keyframes victoryFlash {0%{background:rgba(255,255,255,0);transform:scale(0.9);}40%{background:rgba(255,255,255,0.6);}70%{background:rgba(255,255,255,0.2);}100%{background:rgba(255,255,255,0);} }\n@keyframes popScale {0%{transform:scale(0.3) rotate(-10deg); opacity:0;}60%{transform:scale(1.1) rotate(3deg); opacity:1;}100%{transform:scale(1);} }\n@keyframes fadeUp {0%{opacity:0; transform:translateY(20px);}100%{opacity:1; transform:translateY(0);} }\n@keyframes defeatShake {0%,100%{transform:translateX(0);}10%,30%,50%,70%,90%{transform:translateX(-10px);}20%,40%,60%,80%{transform:translateX(10px);} }\n@keyframes fadeOut {0%{opacity:1;}100%{opacity:0;} }`;
                document.head.appendChild(styleEl);
            }
            // Animate health bars fade-out
            const bossBar = document.getElementById('bossHealth'); if(bossBar){ bossBar.style.transition='1s'; bossBar.style.filter='brightness(2)'; bossBar.style.transform='scaleX(0)'; }
        }
        function playBossDefeatAnimation(){
            const stage = document.getElementById('bossStage');
            if(!stage) return;
            const overlay = document.createElement('div');
            overlay.style.position='absolute';
            overlay.style.left='0'; overlay.style.top='0'; overlay.style.width='100%'; overlay.style.height='100%';
            overlay.style.pointerEvents='none';
            overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center';
            overlay.style.animation='defeatShake 0.6s ease-out';
            overlay.innerHTML='<div style="text-align:center; animation: fadeOut 1s ease-out forwards;">\n <div style="font-size:3em;">üíÄ</div>\n <div style="font-size:1.5em; font-weight:bold; color:#842029; margin-top:10px;">KALAH...</div>\n <div style="font-size:1em; color:#666; margin-top:8px;">Coba lagi untuk menang!</div>\n</div>';
            stage.style.position='relative'; stage.appendChild(overlay);
            // Darken player health bar
            const playerBar = document.getElementById('playerHealth'); 
            if(playerBar){ playerBar.style.transition='0.8s'; playerBar.style.filter='grayscale(1) brightness(0.5)'; }
        }
        // =====================================================
        // FINAL SCORECARD - Show after Round 6
        // =====================================================
        function showFinalScorecard(){
            const score = calculateFinalScore();
            
            // Create fullscreen scorecard overlay
            const overlay = document.createElement('div');
            overlay.id = 'scorecardOverlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                z-index: 9999; display: flex; align-items: center; justify-content: center;
                animation: fadeInOverlay 0.8s ease-out;
                overflow-y: auto;
                overflow-x: hidden;
            `;
            
            // Determine grade color
            let gradeColor = '#4CAF50'; // A = green
            if(score.grade === 'B') gradeColor = '#2196F3'; // blue
            else if(score.grade === 'C') gradeColor = '#FF9800'; // orange
            else if(score.grade === 'D') gradeColor = '#F44336'; // red
            
            overlay.innerHTML = `
                <div style="text-align: center; color: white; max-width: 900px; padding: 50px; animation: slideUpBounce 0.8s ease-out; background: rgba(255,255,255,0.1); border-radius: 30px; backdrop-filter: blur(10px); border: 3px solid rgba(255,255,255,0.3); margin: auto; width: 90%;">
                    <div style="font-size: 4em; margin-bottom: 15px; animation: rotateBounce 1s ease-out;">üìä</div>
                    <h1 style="font-size: 3em; margin: 15px 0; text-shadow: 3px 3px 6px rgba(0,0,0,0.4);">
                        HASIL AKHIR
                    </h1>
                    <h2 style="font-size: 1.8em; margin: 10px 0; opacity: 0.9;">
                        Fase 5: Verification Game Complete!
                    </h2>
                    
                    <div style="background: rgba(255,255,255,0.15); padding: 40px; border-radius: 20px; margin: 30px 0;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin-bottom: 30px;">
                            <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px;">
                                <div style="font-size: 3em; font-weight: bold; color: #FFD700;">${score.percentage}%</div>
                                <div style="font-size: 1.3em; margin-top: 8px;">Persentase Benar</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px;">
                                <div style="font-size: 3em; font-weight: bold; color: ${gradeColor};">${score.grade}</div>
                                <div style="font-size: 1.3em; margin-top: 8px;">Nilai Akhir</div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.25); padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                            <div style="font-size: 1.5em; font-weight: bold; margin-bottom: 15px;">üìà Detail Skor</div>
                            <div style="font-size: 1.3em; line-height: 1.8;">
                                Jawaban Benar: <strong>${score.totalCorrect}</strong> dari <strong>${score.totalQuestions}</strong>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.2); padding: 25px; border-radius: 15px;">
                            <div style="font-size: 1.3em; font-weight: bold; margin-bottom: 15px;">üéØ Breakdown Per Ronde</div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 1.1em;">
                                <div>R1: ${gameScore.round1.correct}/${gameScore.round1.total}</div>
                                <div>R2: ${gameScore.round2.correct}/${gameScore.round2.total}</div>
                                <div>R3: ${gameScore.round3.correct}/${gameScore.round3.total}</div>
                                <div>R4: ${gameScore.round4.correct}/${gameScore.round4.total}</div>
                                <div>R5: ${gameScore.round5.correct}/${gameScore.round5.total}</div>
                                <div>R6: ${gameScore.round6.correct}/${gameScore.round6.total}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="font-size: 1.4em; margin: 25px 0; line-height: 1.6; color: #E3F2FD;">
                        ${score.grade === 'A' ? 'üåü Luar Biasa! Kamu menguasai konsep alkana dengan sempurna!' : 
                          score.grade === 'B' ? 'üëç Bagus! Kamu memahami konsep alkana dengan baik!' :
                          score.grade === 'C' ? 'üìö Cukup Baik! Terus pelajari konsep alkana!' :
                          'üí™ Jangan menyerah! Pelajari kembali konsep alkana CnH2n+2!'}
                    </div>
                    
                    <button onclick="claimVictoryWithAnimation()" class="btn" style="
                        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                        color: #000; font-size: 1.8em; padding: 25px 60px; margin: 25px 10px;
                        border: 4px solid #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.4);
                        animation: buttonPulse 1.5s ease-in-out infinite;
                        font-weight: bold;
                    ">
                        üèÜ KLAIM KEMENANGAN
                    </button>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Store score for certificate
            window.finalGameScore = score;
        }
        
        function claimVictoryWithAnimation(){
            // Remove scorecard
            const scorecard = document.getElementById('scorecardOverlay');
            if(scorecard) scorecard.remove();
            
            // Show grand finale with confetti
            showGrandFinale();
        }
        // =====================================================
        // GRAND FINALE ANIMATION - All Rounds Complete
        // =====================================================
        function showGrandFinale(){
            // Create fullscreen overlay
            const overlay = document.createElement('div');
            overlay.id = 'grandFinaleOverlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                z-index: 9999; display: flex; align-items: center; justify-content: center;
                animation: fadeInOverlay 0.6s ease-out;
                overflow-y: auto;
                overflow-x: hidden;
            `;
            
            overlay.innerHTML = `
                <div style="text-align: center; color: white; max-width: 800px; padding: 40px; animation: slideUpBounce 0.8s ease-out; margin: auto;">
                    <div style="font-size: 5em; margin-bottom: 20px; animation: rotateBounce 1s ease-out;">üéâ</div>
                    <h1 style="font-size: 3.5em; margin: 20px 0; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); animation: glowPulse 2s ease-in-out infinite;">
                        SELAMAT!
                    </h1>
                    <h2 style="font-size: 2em; margin: 15px 0; opacity: 0.95;">
                        Kamu telah menyelesaikan semua tantangan!
                    </h2>
                    <div style="background: rgba(255,255,255,0.2); padding: 30px; border-radius: 20px; margin: 30px 0; backdrop-filter: blur(10px);">
                        <div style="font-size: 1.5em; margin-bottom: 15px;">‚ú® Prestasi Kamu ‚ú®</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 10px;">
                                <div style="font-size: 2em;">üéØ</div>
                                <div style="font-size: 1.2em; font-weight: bold;">Ronde 1</div>
                                <div>Prediksi</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 10px;">
                                <div style="font-size: 2em;">üìä</div>
                                <div style="font-size: 1.2em; font-weight: bold;">Ronde 2</div>
                                <div>Klasifikasi</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 10px;">
                                <div style="font-size: 2em;">‚ö°</div>
                                <div style="font-size: 1.2em; font-weight: bold;">Ronde 3</div>
                                <div>Speed Quiz</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 10px;">
                                <div style="font-size: 2em;">üîê</div>
                                <div style="font-size: 1.2em; font-weight: bold;">Ronde 4</div>
                                <div>Dekode</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 10px;">
                                <div style="font-size: 2em;">üö™</div>
                                <div style="font-size: 1.2em; font-weight: bold;">Ronde 5</div>
                                <div>Escape Room</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 10px;">
                                <div style="font-size: 2em;">‚öîÔ∏è</div>
                                <div style="font-size: 1.2em; font-weight: bold;">Ronde 6</div>
                                <div>Boss Battle</div>
                            </div>
                        </div>
                        <div style="margin-top: 25px; font-size: 1.8em; font-weight: bold;">
                            ‚≠ê Total Bintang: <span id="finalStarsCount" style="color: #FFD700;">${document.getElementById('totalStars').textContent}</span> ‚≠ê
                        </div>
                    </div>
                    <div style="font-size: 1.3em; margin: 20px 0; line-height: 1.6;">
                        üéì Kamu telah menguasai konsep rumus alkana <strong>CnH2n+2</strong>!<br>
                        Dari prediksi hingga pertarungan, kamu membuktikan pemahaman yang luar biasa!
                    </div>
                    <button onclick="claimCertificate()" class="btn" style="
                        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
                        color: #000; font-size: 1.5em; padding: 20px 50px; margin: 20px 10px;
                        border: 3px solid #fff; box-shadow: 0 8px 20px rgba(0,0,0,0.3);
                        animation: buttonPulse 1.5s ease-in-out infinite;
                    ">
                        üìú Terima Sertifikat
                    </button>
                    <button onclick="closeGrandFinale()" class="btn" style="
                        background: rgba(255,255,255,0.3); color: white; font-size: 1.2em; 
                        padding: 15px 40px; margin: 20px 10px; border: 2px solid white;
                    ">
                        üîô Kembali
                    </button>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Add confetti effect
            createConfetti();
            
            // Inject animation styles
            if(!document.getElementById('finaleAnimStyles')){
                const styleEl = document.createElement('style');
                styleEl.id = 'finaleAnimStyles';
                styleEl.textContent = `
                    @keyframes fadeInOverlay {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideUpBounce {
                        0% { transform: translateY(100px); opacity: 0; }
                        70% { transform: translateY(-10px); }
                        100% { transform: translateY(0); opacity: 1; }
                    }
                    @keyframes rotateBounce {
                        0% { transform: scale(0) rotate(0deg); }
                        50% { transform: scale(1.2) rotate(180deg); }
                        100% { transform: scale(1) rotate(360deg); }
                    }
                    @keyframes glowPulse {
                        0%, 100% { text-shadow: 0 0 10px rgba(255,255,255,0.5), 0 0 20px rgba(255,255,255,0.3); }
                        50% { text-shadow: 0 0 20px rgba(255,255,255,0.8), 0 0 40px rgba(255,255,255,0.6); }
                    }
                    @keyframes buttonPulse {
                        0%, 100% { transform: scale(1); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
                        50% { transform: scale(1.05); box-shadow: 0 12px 30px rgba(255,215,0,0.6); }
                    }
                    @keyframes confettiFall {
                        to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
                    }
                `;
                document.head.appendChild(styleEl);
            }
        }
        
        function createConfetti(){
            const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F'];
            for(let i = 0; i < 50; i++){
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: fixed;
                    width: 10px;
                    height: 10px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    top: -10px;
                    left: ${Math.random() * 100}%;
                    opacity: 0.8;
                    z-index: 10000;
                    animation: confettiFall ${2 + Math.random() * 3}s linear infinite;
                    animation-delay: ${Math.random() * 2}s;
                    border-radius: 50%;
                `;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 6000);
            }
        }
        
        function claimCertificate(){
            closeGrandFinale();
            goToPhase(6);
        }
        
        function closeGrandFinale(){
            const overlay = document.getElementById('grandFinaleOverlay');
            if(overlay){
                overlay.style.animation = 'fadeInOverlay 0.3s ease-out reverse';
                setTimeout(() => overlay.remove(), 300);
            }
        }
        // =====================================================
        // RONDE 3: SPEED QUIZ (IMPLEMENTATION)
        // =====================================================
        let speedQuestions = [];
        let speedIndex = 0;
        let speedScore = 0;
        let speedCorrect = 0;
        let speedWrong = 0;
        let speedTime = 60;
        let speedTimerInterval = null;
        let quizActive = false;

        function buildSpeedQuestions(){
            // Kumpulan soal: variasi pola rumus alkana, identifikasi, perhitungan H, n, nama.
            const base = [
                { q:'Apa rumus umum alkana?', choices:['CnH2n','CnH2n+2','CnHn+2','CnH2n-2'], correct:1, explain:'Alkana jenuh: CnH2n+2.' },
                { q:'Jika n=5 pada alkana, berapa jumlah H?', choices:['10','12','14','16'], correct:2, explain:'2*5+2 = 12.' },
                { q:'Manakah yang merupakan alkana?', choices:['C4H8','C3H8','C2H2','C5H10'], correct:1, explain:'C3H8 sesuai 2*3+2.' },
                { q:'Nama alkana dengan 6 karbon?', choices:['Pentana','Heksana','Heptana','Oktona'], correct:1, explain:'6 karbon = Heksana.' },
                { q:'Berapa H pada heptana?', choices:['14','16','18','12'], correct:1, explain:'n=7 => 2*7+2=16 (jawaban 16). Koreksi opsi: periksa indeks.' },
                { q:'C7H16 adalah?', choices:['Alkana','Alkena','Alkuna','Aren'], correct:0, explain:'C7H16 memenuhi rumus alkana.' },
                { q:'Jika jumlah H = 20 dan itu alkana, berapa n?', choices:['8','9','10','7'], correct:1, explain:'2n+2=20 => n=9.' },
                { q:'Manakah bukan alkana?', choices:['C2H6','C4H10','C5H12','C6H10'], correct:3, explain:'C6H10 kurang 2 H untuk alkana (harus C6H14).' },
                { q:'Rantai lurus alkana C8H18 bernama?', choices:['Oktana','Nonana','Dekana','Heptana'], correct:0, explain:'8 karbon = Oktana.' },
                { q:'Alkana paling sederhana adalah?', choices:['Metana','Etana','Propana','Butana'], correct:0, explain:'Metana (CH4).' }
            ];
            // Perbaiki soal dengan kesalahan opsi (heptana):
            base[4] = { q:'Berapa H pada heptana?', choices:['14','16','18','12'], correct:1, explain:'Heptana: 2*7+2=16.' };
            // Acak urutan soal
            speedQuestions = base.sort(()=>Math.random()-0.5);
        }
        function startSpeedQuiz(){
            if(quizActive) return; // sudah berjalan
            buildSpeedQuestions();
            speedIndex=0; speedScore=0; speedCorrect=0; speedWrong=0; speedTime=60; quizActive=true;
            updateSpeedStats();
            document.getElementById('round3Feedback').style.display='none';
            document.getElementById('round3Next').style.display='none';
            document.getElementById('speedQuestion').textContent='Sedang memuat soal...';
            renderSpeedQuestion();
            speedTimerInterval = setInterval(()=>{
                speedTime--; updateSpeedTimer();
                if(speedTime<=0){ endSpeedQuiz('Waktu habis'); }
            },1000);
        }
        function updateSpeedTimer(){ const el=document.getElementById('round3Timer'); if(el) el.textContent=speedTime; }
        function updateSpeedStats(){
            const scoreEl=document.getElementById('speedScore');
            const correctEl=document.getElementById('speedCorrect');
            const wrongEl=document.getElementById('speedWrong');
            if(scoreEl) scoreEl.textContent=speedScore;
            if(correctEl) correctEl.textContent=speedCorrect;
            if(wrongEl) wrongEl.textContent=speedWrong;
        }
        function renderSpeedQuestion(){
            if(speedIndex>=speedQuestions.length){ endSpeedQuiz('Semua soal terjawab'); return; }
            const qObj = speedQuestions[speedIndex];
            const qEl = document.getElementById('speedQuestion');
            const choicesEl = document.getElementById('speedChoices');
            if(!qEl||!choicesEl) return;
            qEl.textContent = 'Soal '+(speedIndex+1)+'/'+speedQuestions.length+': '+qObj.q;
            choicesEl.innerHTML='';
            qObj.choices.forEach((c,idx)=>{
                const btn = document.createElement('button');
                btn.className='btn btn-secondary';
                btn.style.padding='10px';
                btn.textContent=c;
                btn.onclick=()=>answerSpeedQuiz(idx);
                choicesEl.appendChild(btn);
            });
        }
        function answerSpeedQuiz(choiceIdx){
            if(!quizActive) return;
            const qObj = speedQuestions[speedIndex];
            const correct = (choiceIdx===qObj.correct);
            if(correct){ speedScore+=10; speedCorrect++; }
            else { speedWrong++; }
            updateSpeedStats();
            speedIndex++;
            renderSpeedQuestion();
        }
        function endSpeedQuiz(reason){
            quizActive=false;
            clearInterval(speedTimerInterval); speedTimerInterval=null;
            const fb=document.getElementById('round3Feedback');
            fb.style.display='block';
            if(reason==='Semua soal terjawab'){
                fb.style.background='#d4edda'; fb.style.color='#1b5e20';
                fb.innerHTML='Selesai! Skor: '+speedScore+'. Benar: '+speedCorrect+', Salah: '+speedWrong+'.';
            } else {
                fb.style.background='#fff3cd'; fb.style.color='#856404';
                fb.innerHTML='Quiz berakhir: '+reason+'. Skor: '+speedScore+'. Benar: '+speedCorrect+', Salah: '+speedWrong+'.';
            }
            // Beri bintang berdasar kinerja
            if(speedScore>=70){ incrementStars(3); }
            else if(speedScore>=40){ incrementStars(2); }
            else if(speedScore>=10){ incrementStars(1); }
            document.getElementById('round3Next').style.display='block';
            const choicesEl=document.getElementById('speedChoices'); if(choicesEl) choicesEl.innerHTML='';
            const qEl=document.getElementById('speedQuestion'); if(qEl) qEl.textContent='Quiz selesai.';
            
            // Track score
            gameScore.round3.correct = speedCorrect;
            gameScore.round3.total = speedCorrect + speedWrong;
        }
    </script>
</body>
</html>
